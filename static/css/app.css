/* ===== Reset & Base ===== */
html, body {
  height: 100%;
  width: 100%;
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #ffffff;
  font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-text-size-adjust: 100%;
  scrollbar-width: none;
  -ms-overflow-style: none;
}
.dark-mode, .dark-mode body { background: #191919; }
body:has(.dark-mode) { background: #191919; }
::-webkit-scrollbar { display: none; }
*, *::before, *::after {
  box-sizing: border-box;
}

/* ===== Shell ===== */
.shell-container {
  display: flex;
  flex-direction: column;
  height: 100vh;
  height: 100dvh;
  width: 100%;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}
.shell-content {
  flex: 1;
  min-height: 0;
  display: flex;
  flex-direction: column;
  background: var(--background-color, #ffffff);
  overflow: hidden;
}
.shell-content > .home-view,
.shell-content > .exercise-view,
.shell-content > .designer-view {
  flex: 1;
  min-height: 0;
}
.shell-content:has(> .settings-page) {
  overflow: auto;
}
.dark-mode .shell-content {
  background: var(--background-color, #191919);
}

/* ===== Header ===== */
.app-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 24px;
  padding-top: calc(14px + env(safe-area-inset-top, 0px));
  padding-left: calc(24px + env(safe-area-inset-left, 0px));
  padding-right: calc(24px + env(safe-area-inset-right, 0px));
  background: linear-gradient(to bottom, rgba(255,255,255,0.6) 0%, rgba(255,255,255,0.85) 100%);
  backdrop-filter: saturate(180%) blur(20px);
  -webkit-backdrop-filter: saturate(180%) blur(20px);
  color: #1d1d1f;
  border-bottom: none;
  position: relative;
  z-index: 50;
  flex-shrink: 0;
}
.app-header::after {
  content: '';
  position: absolute;
  bottom: -20px;
  left: 0;
  right: 0;
  height: 20px;
  background: linear-gradient(to bottom, rgba(255,255,255,0.15), transparent);
  pointer-events: none;
  z-index: 49;
}
.dark-mode .app-header {
  background: #202020;
  color: #f5f5f7;
  border-bottom: none;
}
.dark-mode .app-header::after {
  background: transparent;
}
.header-left { flex: 1; }
.header-right {
  flex: 0 0 auto;
  display: flex;
  align-items: center;
  gap: 0.35rem;
}
.app-title {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 600;
  letter-spacing: 0.02em;
  cursor: pointer;
  display: inline;
}
.app-title:hover { opacity: 0.85; }

/* Icon Button */
.icon-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  background: rgba(0,0,0,0.06);
  border: none;
  border-radius: 50%;
  cursor: pointer;
  transition: background 0.15s ease;
  color: #1d1d1f;
  text-decoration: none;
}
.icon-btn:hover { background: rgba(0,0,0,0.12); }
.dark-mode .icon-btn { background: rgba(255,255,255,0.1); color: #f5f5f7; }
.dark-mode .icon-btn:hover { background: rgba(255,255,255,0.2); }
.icon { width: 18px; height: 18px; }

/* User Menu */
.user-menu { position: relative; }
.user-menu summary { list-style: none; }
.user-menu summary::-webkit-details-marker { display: none; }
.user-menu .dropdown-menu { display: none; }
.user-menu[open] .dropdown-menu {
  display: block;
  position: absolute;
  top: calc(100% + 8px);
  right: 0;
  min-width: 160px;
  background: white;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.15);
  overflow: hidden;
  z-index: 100;
  animation: dropdownIn 0.15s ease;
}
@keyframes dropdownIn {
  from { opacity:0; transform:translateY(-4px); }
  to { opacity:1; transform:translateY(0); }
}
.dropdown-item {
  width: 100%;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.65rem 1rem;
  background: none;
  border: none;
  font-size: 0.9rem;
  color: #374151;
  cursor: pointer;
  text-align: left;
  transition: background 0.15s;
}
.dropdown-item:hover { background: #f3f4f6; }
.dropdown-icon { font-size: 1rem; }
.dark-mode .user-menu[open] .dropdown-menu {
  background: #141416;
  border-color: #2a2a2c;
  box-shadow: 0 8px 24px rgba(0,0,0,0.3);
}
.dark-mode .dropdown-item { color: #f5f5f7; }
.dark-mode .dropdown-item:hover { background: #1e1e20; }

/* ===== Settings Modal ===== */
.modal-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 1rem;
  animation: fadeIn 0.2s ease;
}
@keyframes fadeIn { from{opacity:0} to{opacity:1} }
.modal-content {
  background: white;
  border-radius: 12px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  width: 100%;
  max-width: 480px;
  max-height: 90vh;
  display: flex;
  flex-direction: column;
  animation: slideUp 0.2s ease;
}
@keyframes slideUp {
  from { opacity:0; transform:translateY(20px); }
  to { opacity:1; transform:translateY(0); }
}
.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid #e0e0e0;
  flex-shrink: 0;
}
.modal-header h2 { margin:0; font-size:1.25rem; font-weight:600; color:#333; }
.close-btn {
  width:32px; height:32px;
  display:flex; align-items:center; justify-content:center;
  background:none; border:none; border-radius:6px;
  font-size:1.5rem; color:#666; cursor:pointer; transition:all 0.2s;
}
.close-btn:hover { background:#f0f0f0; color:#333; }
.modal-body { padding:1.5rem; overflow-y:auto; flex:1; }
.settings-section { margin-bottom:0.5rem; }
.section-title { margin:0 0 0.75rem; font-size:1rem; font-weight:600; color:#333; }
.section-description { margin:-0.5rem 0 0.75rem; font-size:0.85rem; color:#666; }
.settings-divider { border:none; border-top:1px solid #e0e0e0; margin:1.25rem 0; }

/* Theme Segmented */
.theme-segmented {
  display:flex; background:#f3f4f6; border-radius:8px; padding:3px; gap:2px;
}
.theme-segment {
  flex:1; padding:0.5rem 1rem; border:none; border-radius:6px;
  background:transparent; font-size:0.9rem; color:#666;
  cursor:pointer; transition:all 0.15s ease; font-weight:500;
}
.theme-segment:hover { color:#333; }
.theme-segment.active {
  background:white; color:#333; box-shadow:0 1px 3px rgba(0,0,0,0.1);
}

/* Stage Names */
.stage-names-list { display:flex; flex-direction:column; gap:0.6rem; }
.stage-name-row { display:flex; align-items:center; gap:0.75rem; }
.stage-dot { width:12px; height:12px; border-radius:50%; flex-shrink:0; }
.stage-label { font-size:0.85rem; font-weight:600; color:#555; white-space:nowrap; min-width:56px; }
.stage-name-input {
  flex:1; padding:0.5rem 0.75rem; font-size:0.9rem;
  border:1px solid #ddd; border-radius:6px; background:white; color:#333;
}
.stage-name-input:focus { outline:none; border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59,130,246,0.1); }
.reset-defaults-btn {
  margin-top:0.75rem; padding:0; background:none; border:none;
  font-size:0.8rem; color:#3b82f6; cursor:pointer; text-decoration:none;
}
.reset-defaults-btn:hover { text-decoration:underline; }

/* Dark mode settings */
.dark-mode .modal-overlay { background:rgba(0,0,0,0.7); }
.dark-mode .modal-content { background:#141416; }
.dark-mode .modal-header { border-color:#2a2a2c; }
.dark-mode .modal-header h2 { color:#f5f5f7; }
.dark-mode .close-btn { color:#636366; }
.dark-mode .close-btn:hover { background:#1e1e20; color:#f5f5f7; }
.dark-mode .section-title { color:#f5f5f7; }
.dark-mode .section-description { color:#86868b; }
.dark-mode .settings-divider { border-color:#2a2a2c; }
.dark-mode .theme-segmented { background:#1e1e20; }
.dark-mode .theme-segment { color:#86868b; }
.dark-mode .theme-segment:hover { color:#d2d2d7; }
.dark-mode .theme-segment.active { background:#141416; color:#f5f5f7; box-shadow:0 1px 3px rgba(0,0,0,0.3); }
.dark-mode .stage-label { color:#86868b; }
.dark-mode .stage-name-input { background:#1e1e20; border-color:#2a2a2c; color:#f5f5f7; }
.dark-mode .stage-name-input:focus { border-color:#0a84ff; }
.dark-mode .reset-defaults-btn { color:#0a84ff; }
@media (max-width:480px) {
  .modal-content { max-height:100dvh; border-radius:0; }
  .modal-overlay { padding:0; }
}

/* ===== Songs Browse / Library ===== */
.home-view {
  display:flex; flex-direction:column; gap:1.5rem;
  padding:1.5rem 3.5rem; padding-bottom:calc(5rem + env(safe-area-inset-bottom, 0px));
  padding-left:calc(3.5rem + env(safe-area-inset-left, 0px));
  padding-right:calc(3.5rem + env(safe-area-inset-right, 0px));
  overflow-y:auto; flex:1; min-height:0;
  scrollbar-width:none; -ms-overflow-style:none;
}
.home-view::-webkit-scrollbar { display:none; }

/* Library Sections */
.library-section { margin:0; }
.section-title {
  margin:0 0 0.75rem;
  font-size:1.1rem; font-weight:600; color:#1d1d1f; letter-spacing:-0.01em;
}
.dark-mode .section-title { color:#f5f5f7; }

/* --- Continue Practicing (horizontal scroll, larger cards) --- */
.continue-scroll {
  display:flex; gap:1rem; overflow-x:auto; scroll-behavior:smooth;
  padding:4px 0; scrollbar-width:none; -ms-overflow-style:none;
}
.continue-scroll::-webkit-scrollbar { display:none; }

.continue-card {
  min-width:200px; max-width:240px; flex-shrink:0;
  cursor:pointer; background:transparent; border:none; border-radius:0; overflow:visible;
}
.continue-card:hover { z-index:2; }
.continue-thumbnail {
  width:100%; aspect-ratio:1; background:#e8e8ed;
  display:flex; align-items:center; justify-content:center; overflow:hidden;
  border-radius:12px;
  box-shadow:0 2px 8px rgba(0,0,0,0.08), 0 1px 3px rgba(0,0,0,0.06);
  transition:transform 0.2s ease, box-shadow 0.2s ease;
}
.continue-card:hover .continue-thumbnail {
  transform:scale(1.015);
  box-shadow:0 8px 24px rgba(0,0,0,0.16), 0 2px 6px rgba(0,0,0,0.08);
}
.continue-info { padding:0.5rem 0.15rem 0; display:flex; flex-direction:column; gap:0.2rem; }
.continue-title {
  font-size:0.85rem; font-weight:500; color:#1d1d1f; letter-spacing:-0.01em;
  overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
}
.continue-artist { font-size:0.78rem; color:#86868b; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.continue-time { font-size:0.72rem; color:#9ca3af; }

.dark-mode .continue-thumbnail { background:#1e1e20; box-shadow:0 2px 8px rgba(0,0,0,0.25), 0 1px 3px rgba(0,0,0,0.15); }
.dark-mode .continue-card:hover .continue-thumbnail { box-shadow:0 6px 20px rgba(0,0,0,0.4), 0 2px 6px rgba(0,0,0,0.2); }
.dark-mode .continue-title { color:#f5f5f7; }
.dark-mode .continue-artist { color:#86868b; }

/* --- Needs Attention (horizontal scroll, compact cards) --- */
.attention-scroll {
  display:flex; gap:0.75rem; overflow-x:auto; scroll-behavior:smooth;
  padding:4px 0; scrollbar-width:none; -ms-overflow-style:none;
}
.attention-scroll::-webkit-scrollbar { display:none; }

.attention-card {
  min-width:220px; max-width:280px; flex-shrink:0;
  display:flex; gap:0.75rem; align-items:center;
  padding:0.6rem 0.75rem; cursor:pointer;
  background:rgba(0,0,0,0.02); border-radius:10px;
  transition:background 0.15s;
}
.attention-card:hover { background:rgba(0,0,0,0.05); }
.dark-mode .attention-card { background:rgba(255,255,255,0.03); }
.dark-mode .attention-card:hover { background:rgba(255,255,255,0.06); }

.attention-art {
  width:44px; height:44px; min-width:44px; border-radius:8px; overflow:hidden;
  background:#e8e8ed; display:flex; align-items:center; justify-content:center;
}
.dark-mode .attention-art { background:#1e1e20; }
.attention-art .thumbnail-img { width:100%; height:100%; object-fit:cover; object-position:top; }
.thumbnail-placeholder-sm { font-size:1.2rem; opacity:0.4; }

.attention-info { flex:1; min-width:0; display:flex; flex-direction:column; gap:0.15rem; }
.attention-title {
  font-size:0.82rem; font-weight:500; color:#1d1d1f;
  overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
}
.attention-time { font-size:0.72rem; color:#9ca3af; }
.dark-mode .attention-title { color:#f5f5f7; }

/* --- Progress Bar (shared) --- */
.progress-row { display:flex; align-items:center; gap:0.4rem; }
.progress-bar {
  flex:1; height:4px; background:#e5e7eb; border-radius:2px; overflow:hidden;
}
.progress-bar-sm { height:3px; }
.progress-fill {
  height:100%; background:#22c55e; border-radius:2px;
  transition:width 0.3s ease;
}
.progress-fraction { font-size:0.72rem; color:#9ca3af; white-space:nowrap; }
.progress-fraction-sm { font-size:0.7rem; }
.dark-mode .progress-bar { background:#2a2a2c; }

/* --- All Songs Header Controls --- */
.library-all-songs { flex:1; display:flex; flex-direction:column; min-height:0; }
.all-songs-header { margin-bottom:0.75rem; }
.all-songs-controls {
  display:flex; align-items:center; gap:0.75rem; flex-wrap:wrap; margin-top:0.5rem;
}

/* Search */
.library-search {
  position:relative; display:flex; align-items:center; min-width:160px; max-width:240px; flex:1;
}
.search-icon {
  position:absolute; left:0.5rem; width:16px; height:16px; color:#9ca3af; pointer-events:none;
}
.library-search-input {
  width:100%; padding:0.4rem 1.8rem 0.4rem 2rem;
  border:1px solid transparent; border-radius:8px; font-size:0.82rem;
  background:rgba(0,0,0,0.04); color:#1d1d1f; outline:none; transition:all 0.15s;
}
.library-search-input:focus {
  border-color:#d1d5db; background:rgba(0,0,0,0.02);
}
.library-search-clear {
  position:absolute; right:0.4rem; background:none; border:none;
  font-size:1rem; color:#9ca3af; cursor:pointer; padding:0; line-height:1;
}
.dark-mode .library-search-input { background:rgba(255,255,255,0.06); color:#f5f5f7; border-color:transparent; }
.dark-mode .library-search-input:focus { border-color:#3a3a3c; background:rgba(255,255,255,0.04); }

/* Filter Chips */
.filter-chips {
  display:flex; gap:0.35rem; overflow-x:auto; scrollbar-width:none;
  -ms-overflow-style:none; flex-shrink:0;
}
.filter-chips::-webkit-scrollbar { display:none; }
.filter-chip {
  padding:0.25rem 0.65rem; border-radius:100px; border:1px solid #d1d5db;
  background:transparent; color:#6b7280; font-size:0.75rem; cursor:pointer;
  white-space:nowrap; transition:all 0.15s; font-weight:500;
}
.filter-chip:hover { border-color:#9ca3af; color:#374151; }
.filter-chip.active {
  background:#1d1d1f; color:#fff; border-color:#1d1d1f;
}
.dark-mode .filter-chip { border-color:#3a3a3c; color:#9ca3af; }
.dark-mode .filter-chip:hover { border-color:#636366; color:#e5e7eb; }
.dark-mode .filter-chip.active { background:#f5f5f7; color:#1d1d1f; border-color:#f5f5f7; }

/* Sort Dropdown */
.sort-dropdown { position:relative; flex-shrink:0; }
.sort-btn {
  display:flex; align-items:center; gap:0.3rem; padding:0.25rem 0.5rem;
  background:transparent; border:1px solid transparent; border-radius:6px;
  font-size:0.78rem; color:#6b7280; cursor:pointer; transition:all 0.15s; font-weight:500;
}
.sort-btn:hover { color:#374151; }
.sort-chevron { width:14px; height:14px; }
.sort-menu {
  display:none; position:absolute; top:100%; right:0; margin-top:4px;
  background:rgba(255,255,255,0.95); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px);
  border:1px solid rgba(0,0,0,0.06); border-radius:10px;
  box-shadow:0 4px 16px rgba(0,0,0,0.1); min-width:150px; z-index:50; overflow:hidden;
}
.sort-menu.open { display:block; }
.sort-option {
  display:block; width:100%; padding:0.5rem 0.75rem; background:none; border:none;
  text-align:left; font-size:0.8rem; color:#374151; cursor:pointer; transition:background 0.12s;
}
.sort-option:hover { background:rgba(0,0,0,0.04); }
.sort-option.active { font-weight:600; color:#1d1d1f; }
.dark-mode .sort-btn { color:#9ca3af; }
.dark-mode .sort-btn:hover { color:#e5e7eb; }
.dark-mode .sort-menu { background:rgba(28,28,30,0.95); border-color:rgba(255,255,255,0.08); box-shadow:0 4px 16px rgba(0,0,0,0.3); }
.dark-mode .sort-option { color:#e5e7eb; }
.dark-mode .sort-option:hover { background:rgba(255,255,255,0.06); }
.dark-mode .sort-option.active { color:#f5f5f7; }

/* View Toggle */
.view-toggle { display:flex; gap:2px; flex-shrink:0; }
.view-btn {
  width:30px; height:30px; display:flex; align-items:center; justify-content:center;
  background:transparent; border:1px solid transparent; border-radius:6px;
  color:#9ca3af; cursor:pointer; transition:all 0.15s;
}
.view-btn svg { width:16px; height:16px; }
.view-btn:hover { color:#6b7280; }
.view-btn.active { color:#1d1d1f; background:rgba(0,0,0,0.04); }
.dark-mode .view-btn.active { color:#f5f5f7; background:rgba(255,255,255,0.06); }
.dark-mode .view-btn:hover { color:#e5e7eb; }

/* No results */
.library-no-results { padding:2rem 0; text-align:center; }
.no-results-text { color:#9ca3af; font-size:0.9rem; margin:0; }

/* --- Grid View --- */
.library-grid {
  display:grid; grid-template-columns:repeat(auto-fill, minmax(180px, 1fr)); gap:1rem;
}

/* --- List View --- */
.library-list { display:flex; flex-direction:column; }
.list-row {
  display:flex; align-items:center; gap:0.75rem;
  padding:0.5rem 0.25rem; cursor:pointer;
  border-bottom:1px solid rgba(0,0,0,0.05); transition:background 0.12s;
}
.list-row:last-child { border-bottom:none; }
.list-row:hover { background:rgba(0,0,0,0.02); }
.dark-mode .list-row { border-bottom-color:rgba(255,255,255,0.05); }
.dark-mode .list-row:hover { background:rgba(255,255,255,0.03); }

.list-art {
  width:40px; height:40px; min-width:40px; border-radius:6px; overflow:hidden;
  background:#e8e8ed; display:flex; align-items:center; justify-content:center;
}
.dark-mode .list-art { background:#1e1e20; }
.list-art .thumbnail-img { width:100%; height:100%; object-fit:cover; object-position:top; }
.list-title {
  flex:1; min-width:0; font-size:0.85rem; font-weight:500; color:#1d1d1f;
  overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
}
.list-artist {
  width:160px; min-width:80px; font-size:0.8rem; color:#86868b;
  overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
}
.list-progress { width:120px; min-width:80px; flex-shrink:0; }
.dark-mode .list-title { color:#f5f5f7; }
.dark-mode .list-artist { color:#86868b; }

/* Search (legacy — keep for compat) */
.search-bar {
  display:flex; gap:0.5rem; align-items:center; margin-bottom:1rem;
}
.search-input {
  flex:1; padding:0.6rem 1rem; border:1px solid #d1d5db;
  border-radius:8px; font-size:0.9rem; outline:none;
}
.search-input:focus { border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59,130,246,0.1); }
.search-close {
  background:none; border:none; font-size:1.25rem; color:#6b7280; cursor:pointer;
}
.dark-mode .search-input { background:#1e1e20; border-color:#2a2a2c; color:#f5f5f7; }

/* Empty / Error States */
.empty-state, .error-state {
  flex:1; display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  text-align:center; color:#6b7280; padding:3rem 1rem;
}
.empty-icon, .error-icon { font-size:4rem; margin-bottom:1rem; }
.empty-state h3, .error-state h3 { margin:0 0 0.5rem; color:#374151; font-size:1.25rem; }
.empty-state p, .error-state p { margin:0; max-width:300px; }
.retry-btn {
  margin-top:1rem; padding:0.5rem 1.5rem; background:#3b82f6; color:white;
  border:none; border-radius:6px; font-size:0.9rem; cursor:pointer; transition:background 0.2s;
}
.retry-btn:hover { background:#2563eb; }

/* Category Rows (legacy — keep for compat) */
.category-rows { display:flex; flex-direction:column; gap:2rem; }
.category-row { position:relative; }
.row-title { margin:0 0 0.75rem; font-size:1.2rem; font-weight:600; color:#1d1d1f; letter-spacing:-0.01em; }
.row-scroll-container { position:relative; }
.row-scroller {
  display:flex; gap:1rem; overflow-x:auto; scroll-behavior:smooth;
  padding:8px 0; scrollbar-width:none; -ms-overflow-style:none;
}
.row-scroller::-webkit-scrollbar { display:none; }

/* Song Card */
.song-card {
  position:relative; min-width:180px; max-width:220px; flex-shrink:0;
  border:none; border-radius:0; overflow:visible; cursor:pointer;
  background:transparent;
}
.song-card:hover { z-index:2; }
.card-thumbnail {
  width:100%; aspect-ratio:1; background:#e8e8ed;
  display:flex; align-items:center; justify-content:center; overflow:hidden;
  border-radius:12px;
  box-shadow:0 2px 8px rgba(0,0,0,0.08), 0 1px 3px rgba(0,0,0,0.06);
  transition:transform 0.2s ease, box-shadow 0.2s ease;
}
.song-card:hover .card-thumbnail {
  transform:scale(1.015);
  box-shadow:0 8px 24px rgba(0,0,0,0.16), 0 2px 6px rgba(0,0,0,0.08);
}
.thumbnail-img { width:100%; height:100%; object-fit:cover; object-position:top; }
.thumbnail-placeholder { font-size:2.5rem; opacity:0.4; }

/* Spotify loading spinner */
.thumbnail-spinner {
  width:28px; height:28px;
  border:3px solid rgba(156,163,175,0.25);
  border-top-color: #6b7280;
  border-radius:50%;
  animation: thumb-spin 0.7s linear infinite;
}
@keyframes thumb-spin { to { transform:rotate(360deg); } }
.dark-mode .thumbnail-spinner {
  border-color: rgba(156,163,175,0.15);
  border-top-color: #9ca3af;
}
.card-info { padding:0.5rem 0.15rem 0; display:flex; flex-direction:column; gap:0.15rem; }
.card-title {
  font-size:0.85rem; font-weight:500; color:#1d1d1f; letter-spacing:-0.01em;
  overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
}
.card-artist { font-size:0.8rem; color:#86868b; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.menu-trigger {
  position:absolute; top:0.5rem; right:0.5rem;
  width:28px; height:28px; display:flex; align-items:center; justify-content:center;
  background:rgba(0,0,0,0.35); backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px);
  border:none; border-radius:50%; cursor:pointer;
  font-size:1.1rem; color:rgba(255,255,255,0.9); opacity:0;
  transition:opacity 0.2s, background 0.2s; z-index:2;
}
.song-card:hover .menu-trigger { opacity:1; }
.menu-trigger:hover { background:rgba(0,0,0,0.5); color:#fff; }

/* Search Grid */
.search-results-grid {
  display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,220px)); gap:1rem;
}

/* FAB */
.fab {
  position:fixed; bottom:calc(1.5rem + env(safe-area-inset-bottom, 0px)); right:calc(1.5rem + env(safe-area-inset-right, 0px));
  width:44px; height:44px; border-radius:50%;
  background:rgba(255,255,255,0.72); backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px);
  border:none; cursor:pointer;
  color:#86868b; display:flex; align-items:center; justify-content:center;
  transition:all 0.2s; z-index:100;
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
}
.fab:hover { background:rgba(255,255,255,0.92); color:#1d1d1f; box-shadow:0 2px 12px rgba(0,0,0,0.12); }
.fab-lg { width:54px; height:54px; }
.fab-icon { width:20px; height:20px; }
.fab-lg .fab-icon { width:24px; height:24px; }
.search-fab {
  position:fixed; bottom:calc(1.5rem + env(safe-area-inset-bottom, 0px)); right:calc(4rem + env(safe-area-inset-right, 0px));
  width:44px; height:44px; border-radius:50%;
  background:rgba(255,255,255,0.72); backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px);
  border:none; cursor:pointer;
  color:#86868b; display:flex; align-items:center; justify-content:center;
  transition:all 0.2s; z-index:100;
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
}
.search-fab:hover { background:rgba(255,255,255,0.92); color:#1d1d1f; box-shadow:0 2px 12px rgba(0,0,0,0.12); }

/* Context Menu */
.menu-backdrop { position:fixed; top:0; left:0; right:0; bottom:0; z-index:9998; }
.menu-dropdown-fixed {
  position:fixed; background:rgba(255,255,255,0.92); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px);
  border:1px solid rgba(0,0,0,0.06);
  border-radius:12px; box-shadow:0 4px 24px rgba(0,0,0,0.12);
  min-width:140px; z-index:9999; overflow:hidden;
}
.menu-item {
  width:100%; padding:0.6rem 1rem; display:flex; align-items:center; gap:0.5rem;
  background:transparent; border:none; cursor:pointer;
  font-size:0.85rem; color:#1d1d1f; text-align:left; transition:background 0.15s;
}
.menu-item:hover { background:rgba(0,0,0,0.04); }
.menu-item.danger { color:#dc2626; }
.menu-item.danger:hover { background:#fef2f2; }

/* Dark mode songs browse */
.dark-mode .home-view { background:#191919; }
.dark-mode .row-title { color:#f5f5f7; }
.dark-mode .song-card { background:transparent; }
.dark-mode .card-thumbnail { background:#1e1e20; box-shadow:0 2px 8px rgba(0,0,0,0.25), 0 1px 3px rgba(0,0,0,0.15); }
.dark-mode .song-card:hover .card-thumbnail { box-shadow:0 6px 20px rgba(0,0,0,0.4), 0 2px 6px rgba(0,0,0,0.2); }
.dark-mode .card-title { color:#f5f5f7; }
.dark-mode .card-artist { color:#86868b; }
.dark-mode .menu-trigger { background:rgba(0,0,0,0.45); color:rgba(255,255,255,0.9); }
.dark-mode .menu-trigger:hover { background:rgba(0,0,0,0.6); color:#fff; }
.dark-mode .menu-dropdown-fixed { background:rgba(28,28,30,0.92); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); border-color:rgba(255,255,255,0.08); box-shadow:0 4px 24px rgba(0,0,0,0.3); }
.dark-mode .menu-item { color:#f5f5f7; background:transparent; }
.dark-mode .menu-item:hover { background:rgba(255,255,255,0.06); }
.dark-mode .menu-item.danger:hover { background:#7f1d1d; }
.dark-mode .fab { background:rgba(30,30,32,0.72); color:#86868b; border:none; box-shadow:0 2px 8px rgba(0,0,0,0.2); }
.dark-mode .fab:hover { background:rgba(30,30,32,0.92); color:#f5f5f7; box-shadow:0 2px 12px rgba(0,0,0,0.3); }
.dark-mode .search-fab { background:rgba(30,30,32,0.72); color:#86868b; border:none; box-shadow:0 2px 8px rgba(0,0,0,0.2); }
.dark-mode .search-fab:hover { background:rgba(30,30,32,0.92); color:#f5f5f7; box-shadow:0 2px 12px rgba(0,0,0,0.3); }
.dark-mode .empty-state, .dark-mode .error-state { color:#9ca3af; }
.dark-mode .empty-state h3, .dark-mode .error-state h3 { color:#e5e7eb; }

@media (max-width:600px) {
  .home-view {
    padding:1rem;
    padding-bottom:calc(4.5rem + env(safe-area-inset-bottom, 0px));
    padding-left:calc(1rem + env(safe-area-inset-left, 0px));
    padding-right:calc(1rem + env(safe-area-inset-right, 0px));
  }
  .song-card { min-width:150px; max-width:170px; }
  .continue-card { min-width:160px; max-width:190px; }
  .search-results-grid { grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); }
  .library-grid { grid-template-columns:repeat(auto-fill, minmax(150px, 1fr)); }
  .all-songs-controls { gap:0.5rem; }
  .library-search { max-width:100%; min-width:0; }
  .list-artist { display:none; }
  .list-progress { width:80px; }
  .menu-trigger { opacity:1; }
}

/* ===== Song Detail ===== */
.exercise-view {
  display:flex; flex-direction:column;
  flex:1; min-height:0; overflow:hidden;
}
.exercise-view-main {
  flex:1; min-width:0; min-height:0; overflow-y:auto;
  padding:1rem 1.5rem; padding-bottom:calc(1rem + env(safe-area-inset-bottom, 0px));
}
.exercise-view.scroll-locked { overflow:hidden; }

/* Smooth transition: returning from editor to practice view */
.exercise-view.returning-from-editor {
  animation: practiceSlideIn 0.35s cubic-bezier(0.4, 0, 0.2, 1) both;
}
@keyframes practiceSlideIn {
  from { transform:translateX(40px); opacity:0; }
  to   { transform:translateX(0); opacity:1; }
}

.song-header-wrapper { margin-bottom:1rem; position:relative; }
.song-header { display:flex; align-items:flex-start; gap:1.25rem; }
.song-album-art { flex-shrink:0; width:100px; height:100px; border-radius:8px; overflow:hidden; box-shadow:0 2px 8px rgba(0,0,0,0.12); }
.song-album-art img { display:block; width:100%; height:100%; object-fit:cover; }
.song-header-left { flex:1; min-width:0; }
.song-header-right { display:flex; align-items:center; gap:0.25rem; flex-shrink:0; }
.song-title { margin:0 0 0.25rem; font-size:1.75rem; font-weight:700; color:#1a1a1a; line-height:1.2; }
.song-artist { margin:0 0 0.5rem; font-size:1rem; color:#666; }
.song-meta-row { display:flex; align-items:center; gap:0.75rem; flex-wrap:wrap; }
.meta-chip {
  display:inline-flex; align-items:center; gap:0.25rem;
  padding:0.25rem 0.6rem; background:#f3f4f6; border-radius:999px;
  font-size:0.8rem; color:#555;
}
.meta-link { font-size:0.8rem; color:rgba(239,68,68,0.6); text-decoration:none; display:inline-flex; align-items:center; gap:0.25rem; }
.meta-link:hover { text-decoration:underline; opacity:1; }
.meta-link.spotify { color:rgba(34,197,94,0.6); }
.meta-link-icon { flex-shrink:0; vertical-align:middle; }
.section-nav { display:flex; flex-wrap:wrap; gap:0.5rem; flex:1; min-width:0; }
.section-pill {
  display:inline-flex; align-items:center; padding:0.3rem 0.75rem;
  font-size:0.8rem; font-weight:600; border:1px solid; border-radius:999px;
  cursor:pointer; transition:all 0.15s ease; white-space:nowrap;
}
.section-pill:hover { filter:brightness(0.92); }
.section-pill:disabled, .section-pill.empty { cursor:default; opacity:0.6; }
.header-icon-btn {
  display:flex; align-items:center; justify-content:center;
  width:32px; height:32px; background:transparent; border:none;
  border-radius:8px; cursor:pointer; color:#9ca3af; transition:all 0.15s;
  text-decoration:none;
}
.header-icon-btn:hover { background:rgba(0,0,0,0.06); color:#6b7280; }
.header-icon-btn.active { color:#3b82f6; background:rgba(59,130,246,0.08); }
.header-icon-btn svg { display:block; }

/* Hover pencil on exercise cards */
.card-edit-pencil {
  position:absolute; top:8px; right:8px; z-index:10;
  display:flex; align-items:center; justify-content:center;
  width:30px; height:30px; border-radius:8px;
  background:rgba(255,255,255,0.85); backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px);
  border:1px solid rgba(0,0,0,0.06);
  color:#6b7280; cursor:pointer;
  opacity:0; transition:opacity 0.15s, background 0.15s, color 0.15s;
  box-shadow:0 1px 4px rgba(0,0,0,0.08);
}
.card-edit-pencil svg { display:block; }
.expanded-card:hover .card-edit-pencil { opacity:1; }
.card-edit-pencil:hover { background:rgba(255,255,255,0.95); color:#374151; }
.editing-exercises .card-edit-pencil { display:none; }

/* Song detail three-dot dropdown */
.song-detail-menu { position:relative; }
.song-detail-dropdown {
  display:none; position:absolute; top:calc(100% + 4px); right:0;
  min-width:170px; background:white; border:1px solid #e5e7eb;
  border-radius:8px; box-shadow:0 8px 24px rgba(0,0,0,0.15);
  overflow:hidden; z-index:100; animation:dropdownIn 0.15s ease;
}
.song-detail-dropdown.open { display:block; }
.dark-mode .song-detail-dropdown { background:#141416; border-color:#2a2a2c; box-shadow:0 8px 24px rgba(0,0,0,0.3); }

/* Edit Exercises Toolbar */
.edit-exercises-toolbar {
  background:transparent; border:none; border-radius:0;
  padding:0; margin-bottom:0.75rem; animation:slideUp 0.2s ease;
}
.edit-toolbar-header {
  display:flex; align-items:center; justify-content:space-between; gap:1rem;
}
.edit-toolbar-left {
  display:flex; align-items:center; gap:0.75rem;
}
.edit-toolbar-title { font-size:0.9rem; font-weight:600; color:#374151; }
.edit-toolbar-done {
  padding:0.35rem 1rem; font-size:0.8rem; font-weight:600; letter-spacing:0.01em;
  background:rgba(0,0,0,0.06); color:#6b7280; border:none; border-radius:8px;
  cursor:pointer; transition:all 0.15s;
}
.edit-toolbar-done:hover { background:rgba(0,0,0,0.1); color:#374151; }
.edit-toolbar-row {
  display:flex; align-items:flex-start; gap:0.75rem; flex-wrap:wrap;
}
.edit-toolbar-label { font-size:0.8rem; font-weight:500; color:#6b7280; white-space:nowrap; padding-top:0.15rem; }

/* Background toggle switch (light/dark) */
.bg-toggle {
  position:relative; width:36px; height:20px; border-radius:10px;
  background:#e5e7eb; border:none; cursor:pointer; padding:0;
  transition:background 0.2s; flex-shrink:0;
}
.bg-toggle-thumb {
  position:absolute; top:2px; left:2px;
  width:16px; height:16px; border-radius:50%;
  background:#fff; box-shadow:0 1px 3px rgba(0,0,0,0.15);
  transition:transform 0.2s;
}
.bg-toggle--dark { background:#4b5563; }
.bg-toggle--dark .bg-toggle-thumb { transform:translateX(16px); background:#1e1e1e; }

.edit-toolbar-hint { font-size:0.72rem; color:#9ca3af; margin:0.4rem 0 0; }

/* Crop resize drag handle (hidden by default, shown in edit mode) */
.card-crop-resize-handle {
  display:none; align-items:center; justify-content:center;
  height:12px; cursor:ns-resize; user-select:none; -webkit-user-select:none;
  transition:background 0.15s;
}
.card-crop-resize-handle:hover { background:rgba(59,130,246,0.08); }
.card-crop-resize-handle:active { background:rgba(59,130,246,0.15); }
.editing-exercises .card-crop-resize-handle { display:flex; }
.resize-handle-bar {
  width:40px; height:4px; border-radius:2px;
  background:#d1d5db; transition:background 0.15s;
}
.card-crop-resize-handle:hover .resize-handle-bar { background:#3b82f6; }

/* Dark mode drag handle */
.dark-mode .card-crop-resize-handle:hover { background:rgba(96,165,250,0.1); }
.dark-mode .resize-handle-bar { background:#4b5563; }
.dark-mode .card-crop-resize-handle:hover .resize-handle-bar { background:#60a5fa; }

/* Dark mode edit toolbar */
.dark-mode .edit-exercises-toolbar { background:transparent; border:none; }
.dark-mode .edit-toolbar-title { color:#e5e7eb; }
.dark-mode .edit-toolbar-label { color:#9ca3af; }
.dark-mode .edit-toolbar-hint { color:#6b7280; }
.dark-mode .edit-toolbar-done { background:rgba(255,255,255,0.08); color:#9ca3af; }
.dark-mode .edit-toolbar-done:hover { background:rgba(255,255,255,0.12); color:#f5f5f7; }
.dark-mode .bg-toggle { background:#3a3a3c; }
.dark-mode .bg-toggle-thumb { background:#d1d5db; }
.dark-mode .bg-toggle--dark { background:#636366; }
.dark-mode .bg-toggle--dark .bg-toggle-thumb { background:#1e1e1e; }
.header-separator { border:none; border-top:1px solid #e5e7eb; margin:1.25rem 0; }

/* ===== Practice Controls Bar ===== */
.practice-controls-bar {
  display:flex; align-items:center; gap:0.65rem; margin-top:1rem; flex-wrap:wrap;
}

/* Segmented Control: View Mode */
.view-mode-segmented {
  display:inline-flex; background:#f3f4f6; border-radius:10px; padding:3px;
  gap:2px;
}
.view-mode-btn {
  padding:0.35rem 0.85rem; font-size:0.78rem; font-weight:600;
  border:none; border-radius:8px; cursor:pointer;
  background:transparent; color:#6b7280;
  transition:all 0.15s ease; white-space:nowrap;
}
.view-mode-btn:hover { color:#374151; }
.view-mode-btn.active {
  background:#fff; color:#1d1d1f;
  box-shadow:0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.06);
}

/* Section pills — filter mode additions */
.section-pill.pill-active {
  filter:brightness(0.85);
  box-shadow:0 0 0 2px rgba(0,0,0,0.15);
}

/* ===== Inline Panels (shared slide-down animation) ===== */
.stats-panel-inline, .display-panel-inline {
  animation:drawerSlideDown 0.2s ease;
  padding:0.75rem 0;
}

/* ===== Display Settings Drawer ===== */
.display-settings-drawer, .display-panel-inline {
  margin-bottom:0.25rem;
}
@keyframes drawerSlideDown {
  from { opacity:0; max-height:0; transform:translateY(-8px); }
  to   { opacity:1; max-height:500px; transform:translateY(0); }
}

.drawer-group {
  padding:0.5rem 0;
}
.drawer-group + .drawer-group {
  border-top:1px solid #f3f4f6;
}
.drawer-group-title {
  display:block; font-size:0.7rem; font-weight:600; color:#9ca3af;
  text-transform:uppercase; letter-spacing:0.05em;
  margin-bottom:0.5rem;
}
.drawer-row {
  display:flex; align-items:center; gap:0.75rem;
  padding:0.4rem 0; min-height:32px;
}
.drawer-label {
  font-size:0.82rem; font-weight:500; color:#374151;
  flex:1; min-width:0;
}
.drawer-slider {
  width:120px; accent-color:#3b82f6; cursor:pointer;
}
.drawer-slider-value {
  font-size:0.75rem; font-weight:600; color:#6b7280;
  min-width:3rem; text-align:right;
}

/* Small segmented control (alignment) */
.drawer-segmented-sm {
  display:inline-flex; background:#f3f4f6; border-radius:8px; padding:2px; gap:2px;
}
.seg-btn-sm {
  padding:0.25rem 0.65rem; font-size:0.72rem; font-weight:600;
  border:none; border-radius:6px; cursor:pointer;
  background:transparent; color:#6b7280; transition:all 0.15s;
}
.seg-btn-sm:hover { color:#374151; }
.seg-btn-sm.active {
  background:#fff; color:#1d1d1f;
  box-shadow:0 1px 2px rgba(0,0,0,0.06);
}

/* Toggle switch (clean view) */
.drawer-toggle {
  position:relative; display:inline-block; cursor:pointer;
  flex-shrink:0;
}
.drawer-toggle input { position:absolute; opacity:0; width:0; height:0; }
.drawer-toggle-track {
  display:block; width:36px; height:20px; border-radius:10px;
  background:#e5e7eb; transition:background 0.2s; position:relative;
}
.drawer-toggle-thumb {
  position:absolute; top:2px; left:2px;
  width:16px; height:16px; border-radius:50%;
  background:#fff; box-shadow:0 1px 3px rgba(0,0,0,0.15);
  transition:transform 0.2s;
}
.drawer-toggle input:checked + .drawer-toggle-track {
  background:#3b82f6;
}
.drawer-toggle input:checked + .drawer-toggle-track .drawer-toggle-thumb {
  transform:translateX(16px);
}

/* ===== Dark mode: Practice Controls ===== */
.dark-mode .view-mode-segmented { background:#1e1e20; }
.dark-mode .view-mode-btn { color:#86868b; }
.dark-mode .view-mode-btn:hover { color:#d2d2d7; }
.dark-mode .view-mode-btn.active {
  background:#2a2a2c; color:#f5f5f7;
  box-shadow:0 1px 3px rgba(0,0,0,0.2);
}
.dark-mode .section-pill.pill-active {
  box-shadow:0 0 0 2px rgba(255,255,255,0.2);
}

/* Dark mode: Display Settings Drawer */
.dark-mode .drawer-group + .drawer-group { border-color:#2a2a2c; }
.dark-mode .drawer-group-title { color:#636366; }
.dark-mode .drawer-label { color:#d2d2d7; }
.dark-mode .drawer-slider-value { color:#86868b; }
.dark-mode .drawer-segmented-sm { background:#1e1e20; }
.dark-mode .seg-btn-sm { color:#86868b; }
.dark-mode .seg-btn-sm:hover { color:#d2d2d7; }
.dark-mode .seg-btn-sm.active { background:#2a2a2c; color:#f5f5f7; }
.dark-mode .drawer-toggle-track { background:#3a3a3c; }
.dark-mode .drawer-toggle input:checked + .drawer-toggle-track { background:#0a84ff; }
.dark-mode .drawer-toggle-thumb { background:#d1d5db; }

/* ===== Clean View State Classes ===== */
.exercise-view.cv-hide-titles .card-overlay-header { display:none; }
.exercise-view.cv-hide-controls .card-controls-bar { display:none; }
.exercise-view.cv-hide-dividers .section-divider { display:none; }
.exercise-view.cv-hide-stages .expanded-card { border-left-color:transparent !important; }
.exercise-view.cv-hide-stages .card-stage-select { display:none; }

/* ===== Practice Controls Right (segmented + smart practice) ===== */
.practice-controls-right {
  display:flex; align-items:center; gap:0.65rem; margin-left:auto; flex-shrink:0;
}
.smart-practice-btn {
  display:inline-flex; align-items:center; gap:0.35rem;
  padding:0.35rem 0.75rem; font-size:0.78rem; font-weight:600;
  border:1px solid #e5e7eb; border-radius:8px;
  background:#fff; color:#6b7280; cursor:pointer;
  transition:all 0.15s ease; white-space:nowrap;
}
.smart-practice-btn:hover { border-color:#d1d5db; color:#374151; background:#f9fafb; }
.smart-practice-btn.active { background:#fef3c7; border-color:#f59e0b; color:#92400e; }
.smart-practice-btn svg { flex-shrink:0; }
.dark-mode .smart-practice-btn { background:#1e1e20; border-color:#2a2a2c; color:#86868b; }
.dark-mode .smart-practice-btn:hover { border-color:#3a3a3c; color:#d2d2d7; }
.dark-mode .smart-practice-btn.active { background:#3a2e10; border-color:#f59e0b; color:#fbbf24; }

/* PDF link button style */
.pdf-link {
  font-size:0.8rem; color:#6b7280; text-decoration:none;
  display:inline-flex; align-items:center; gap:0.25rem;
  cursor:pointer; background:none; border:none; padding:0;
}
.pdf-link:hover { color:#374151; text-decoration:underline; }
.dark-mode .pdf-link { color:#86868b; }
.dark-mode .pdf-link:hover { color:#d2d2d7; }

/* ===== Progress Summary Bar ===== */
.progress-summary-bar {
  display:flex; align-items:center; gap:0.75rem;
  padding:0.55rem 0; cursor:pointer;
  user-select:none; -webkit-user-select:none;
}
.progress-bar-stat {
  display:inline-flex; align-items:center; gap:0.3rem;
  font-size:0.78rem; font-weight:600; color:#374151;
  white-space:nowrap; flex-shrink:0;
}
.progress-bar-stat svg { color:#9ca3af; flex-shrink:0; }
.progress-bar-stat-muted { color:#9ca3af; font-weight:500; }
.progress-stage-bar {
  display:flex; flex:1; height:6px; border-radius:3px;
  overflow:hidden; background:#f3f4f6; gap:1px;
}
.progress-stage-segment { border-radius:2px; min-width:3px; transition:flex 0.3s ease; }

/* Stage bar variant for song cards (smaller) */
.progress-stage-bar-card {
  height:4px; border-radius:2px;
}
.progress-stage-bar-card .progress-stage-segment { border-radius:1px; min-width:2px; }
.progress-stage-bar-sm { height:3px; }

/* Dark mode: Progress Summary Bar */
.dark-mode .progress-bar-stat { color:#d2d2d7; }
.dark-mode .progress-bar-stat svg { color:#636366; }
.dark-mode .progress-bar-stat-muted { color:#636366; }
.dark-mode .progress-stage-bar { background:#2a2a2c; }

/* ===== Stats Panel (progress + sessions) ===== */
.progress-detail-grid {
  display:grid; grid-template-columns:repeat(auto-fit, minmax(110px, 1fr));
  gap:0.75rem; margin-bottom:0.75rem;
}
.progress-detail-item {
  display:flex; flex-direction:column; gap:0.15rem;
}
.progress-detail-value {
  font-size:1rem; font-weight:700; color:#1d1d1f;
}
.progress-detail-label {
  font-size:0.7rem; font-weight:500; color:#9ca3af;
  text-transform:uppercase; letter-spacing:0.03em;
}
.progress-stage-breakdown {
  display:flex; flex-direction:column; gap:0.35rem;
  padding:0.5rem 0; border-top:1px solid #f3f4f6;
}
.progress-stage-row {
  display:flex; align-items:center; gap:0.5rem; font-size:0.8rem;
}
.progress-stage-dot {
  width:8px; height:8px; border-radius:50%; flex-shrink:0;
}
.progress-stage-name { flex:1; color:#6b7280; font-weight:500; }
.progress-stage-count { font-weight:700; color:#374151; min-width:1.5rem; text-align:right; }

/* Session History */
.session-history {
  border-top:1px solid #f3f4f6; padding-top:0.6rem; margin-top:0.15rem;
}
.session-history-header {
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom:0.4rem;
}
.session-history-title {
  font-size:0.7rem; font-weight:600; color:#9ca3af;
  text-transform:uppercase; letter-spacing:0.04em;
}
.session-history-list {
  display:flex; flex-direction:column; gap:0.2rem;
}
.session-history-item {
  display:flex; align-items:center; gap:0.5rem;
  padding:0.35rem 0.5rem; border-radius:8px;
  font-size:0.78rem; transition:background 0.12s;
}
.session-history-item:hover { background:#f9fafb; }
.session-date {
  font-weight:600; color:#374151; min-width:4.5rem;
}
.session-duration {
  color:#6b7280; font-variant-numeric:tabular-nums;
}
.session-exercises {
  margin-left:auto; color:#9ca3af; font-size:0.72rem;
}

/* Dark mode: Stats Panel */
.dark-mode .progress-detail-value { color:#f5f5f7; }
.dark-mode .progress-detail-label { color:#636366; }
.dark-mode .progress-stage-breakdown { border-color:#2a2a2c; }
.dark-mode .progress-stage-name { color:#86868b; }
.dark-mode .progress-stage-count { color:#d2d2d7; }
.dark-mode .session-history { border-color:#2a2a2c; }
.dark-mode .session-history-title { color:#636366; }
.dark-mode .session-date { color:#d2d2d7; }
.dark-mode .session-duration { color:#86868b; }
.dark-mode .session-exercises { color:#636366; }
.dark-mode .session-history-item:hover { background:#1e1e20; }

/* ===== Song Notes (inline in header) ===== */
.song-notes-section {
  padding:0.5rem 0; animation:drawerSlideDown 0.2s ease;
}
.song-notes-textarea {
  width:100%; min-height:70px; padding:0.6rem 0.75rem;
  font-size:0.82rem; line-height:1.6; color:#374151;
  background:#f9fafb; border:1px solid #e5e7eb; border-radius:10px;
  resize:vertical; font-family:inherit;
  transition:border-color 0.15s;
}
.song-notes-textarea:focus {
  outline:none; border-color:#3b82f6;
  box-shadow:0 0 0 3px rgba(59,130,246,0.1);
}
.song-notes-textarea::placeholder { color:#c0c0c4; }
.dark-mode .song-notes-textarea {
  background:#1e1e20; border-color:#2a2a2c; color:#d2d2d7;
}
.dark-mode .song-notes-textarea:focus { border-color:#0a84ff; box-shadow:0 0 0 3px rgba(10,132,255,0.15); }
.dark-mode .song-notes-textarea::placeholder { color:#48484a; }

/* ===== Metronome (inline panel in header) ===== */
.metronome-panel-inline {
  padding:0.75rem 0; animation:drawerSlideDown 0.2s ease;
}
.metronome-panel-row {
  display:flex; align-items:center; gap:0.65rem;
}
.metronome-bpm-group {
  display:flex; align-items:baseline; gap:0.25rem; flex-shrink:0;
}
.metronome-bpm-display {
  font-size:1.5rem; font-weight:800; color:#1d1d1f;
  font-variant-numeric:tabular-nums; line-height:1;
}
.metronome-bpm-label { font-size:0.6rem; font-weight:600; color:#9ca3af; text-transform:uppercase; letter-spacing:0.04em; }
.metronome-slider { flex:1; min-width:60px; accent-color:#3b82f6; cursor:pointer; }
.metronome-play-btn {
  width:36px; height:36px; border-radius:8px; border:none;
  background:#3b82f6; color:#fff; cursor:pointer;
  display:flex; align-items:center; justify-content:center;
  transition:all 0.15s; flex-shrink:0;
}
.metronome-play-btn:hover { background:#2563eb; }
.metronome-play-btn.playing { background:#ef4444; }
.metronome-play-btn.playing:hover { background:#dc2626; }
.metronome-play-btn.playing .icon-play { display:none; }
.metronome-play-btn.playing .icon-stop { display:block !important; }

.metronome-secondary-row {
  margin-top:0.5rem; display:flex; flex-wrap:wrap; gap:0.4rem; align-items:center;
}
.metronome-presets { display:flex; gap:0.25rem; }
.metronome-preset-btn {
  padding:0.2rem 0.5rem; font-size:0.7rem; font-weight:600;
  border:1px solid #e5e7eb; border-radius:6px;
  background:#fff; color:#6b7280; cursor:pointer;
  transition:all 0.15s;
}
.metronome-preset-btn:hover { background:#f3f4f6; color:#374151; }
.metronome-preset-btn.active { background:#eff6ff; border-color:#3b82f6; color:#2563eb; }
.metronome-tap-btn {
  padding:0.2rem 0.6rem; font-size:0.72rem; font-weight:600;
  border:1px solid #e5e7eb; border-radius:6px;
  background:#f9fafb; color:#6b7280; cursor:pointer;
  transition:all 0.15s;
}
.metronome-tap-btn:hover { background:#f3f4f6; color:#374151; }
.metronome-tap-btn:active { background:#e5e7eb; }
.metronome-time-sig { display:flex; gap:0.2rem; }
.metronome-sig-btn {
  padding:0.2rem 0.4rem; font-size:0.65rem; font-weight:600;
  border:1px solid #e5e7eb; border-radius:5px;
  background:#fff; color:#9ca3af; cursor:pointer;
  transition:all 0.15s;
}
.metronome-sig-btn:hover { color:#6b7280; }
.metronome-sig-btn.active { background:#f3f4f6; color:#374151; border-color:#d1d5db; }
.metronome-beat-dots { display:flex; gap:0.4rem; align-items:center; }
.beat-dot {
  width:8px; height:8px; border-radius:50%;
  background:#e5e7eb; transition:background 0.1s;
}
.beat-dot.active { background:#3b82f6; }
.beat-dot:first-child.active { background:#f59e0b; }

/* Dark mode: Metronome */
.dark-mode .metronome-bpm-display { color:#f5f5f7; }
.dark-mode .metronome-bpm-label { color:#636366; }
.dark-mode .metronome-preset-btn { background:#141416; border-color:#2a2a2c; color:#86868b; }
.dark-mode .metronome-preset-btn:hover { background:#2a2a2c; color:#d2d2d7; }
.dark-mode .metronome-preset-btn.active { background:#1a2744; border-color:#0a84ff; color:#0a84ff; }
.dark-mode .metronome-tap-btn { background:#141416; border-color:#2a2a2c; color:#86868b; }
.dark-mode .metronome-tap-btn:hover { background:#2a2a2c; color:#d2d2d7; }
.dark-mode .metronome-play-btn { background:#0a84ff; }
.dark-mode .metronome-play-btn:hover { background:#0071e3; }
.dark-mode .metronome-play-btn.playing { background:#ff453a; }
.dark-mode .metronome-sig-btn { background:#141416; border-color:#2a2a2c; color:#636366; }
.dark-mode .metronome-sig-btn:hover { color:#86868b; }
.dark-mode .metronome-sig-btn.active { background:#2a2a2c; color:#d2d2d7; border-color:#3a3a3c; }
.dark-mode .beat-dot { background:#2a2a2c; }
.dark-mode .beat-dot.active { background:#0a84ff; }
.dark-mode .beat-dot:first-child.active { background:#ff9f0a; }

@media (max-width:480px) {
  .smart-practice-label { display:none; }
  .metronome-secondary-row { gap:0.3rem; }
  .practice-controls-bar { flex-direction:column; align-items:stretch; gap:0.5rem; }
  .section-nav { order:1; }
  .practice-controls-right { order:2; margin-left:0; }
  .view-mode-segmented { display:flex; flex:1; }
  .view-mode-btn { padding:0.3rem 0.45rem; font-size:0.7rem; flex:1; text-align:center; }
  .smart-practice-btn { padding:0.35rem 0.5rem; }
  .song-header { gap:0.75rem; }
  .song-title { font-size:1.35rem; }
  .song-header-right { gap:0.1rem; }
  .header-icon-btn { width:28px; height:28px; }
  .header-icon-btn svg { width:14px; height:14px; }
}
.mastered-banner {
  padding:0.75rem 1rem; background:rgba(34,197,94,0.1);
  border:1px solid rgba(34,197,94,0.3); border-radius:8px;
  color:#16a34a; font-size:0.9rem; font-weight:500; margin-bottom:1rem; text-align:center;
}

/* Section Groups.. */
.section-group { margin-bottom:1rem; }
.section-divider { display:flex; align-items:center; gap:0.75rem; margin-bottom:0.75rem; }
.section-line { flex:1; height:1px; background:#e0e0e0; }
.section-label {
  font-size:0.8rem; font-weight:500; color:#aaa;
  text-transform:uppercase; letter-spacing:0.05em; white-space:nowrap;
}
.section-empty { font-size:0.85rem; color:#ccc; font-style:italic; text-align:center; padding:0.5rem 0; }

/* Expanded Cards */
.expanded-list { display:flex; flex-direction:column; gap:1.25rem; }
.expanded-card-wrapper {
  display:flex; flex-direction:column; gap:0;
}
.expanded-card {
  display:flex; flex-direction:column; border:none; border-radius:14px;
  overflow:hidden; transition:box-shadow 0.3s cubic-bezier(0.25, 0.1, 0.25, 1); border-left:3px solid #9ca3af;
  background:#f5f5f7; position:relative;
  box-shadow:0 2px 8px rgba(0,0,0,0.06), 0 1px 3px rgba(0,0,0,0.04);
}
.expanded-card:hover { box-shadow:0 4px 16px rgba(0,0,0,0.1), 0 2px 6px rgba(0,0,0,0.06); }

/* Controls bar below the card */
.card-controls-bar {
  display:flex; align-items:center; gap:0.5rem;
  padding:0.5rem 0.5rem 0.25rem 0.75rem;
  flex-wrap:wrap;
}
.card-controls-sep {
  width:1px; height:16px; background:#d1d5db; margin:0 0.15rem;
}

/* Card crop area */
.card-crop-area {
  display:flex; flex-direction:column; gap:0.25rem;
  padding:0.5rem 0.75rem; position:relative;
  cursor:pointer;
}

/* Overlay header: name at top-left */
.card-overlay-header {
  display:flex; align-items:center;
  padding:0 0.25rem 0.25rem;
}
.card-title-name {
  margin:0; font-size:0.9rem; font-weight:600; color:#1d1d1f; letter-spacing:-0.01em;
  overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
}
.card-stage-select {
  padding:0.25rem 0.4rem; border:1px solid rgba(0,0,0,0.08); border-radius:8px;
  font-size:0.75rem; font-weight:600; background:#fff; cursor:pointer;
  transition:border-color 0.15s; flex-shrink:0;
}
.card-stage-select:focus { outline:none; border-color:#0071e3; box-shadow:0 0 0 3px rgba(0,113,227,0.15); }
.card-crop-item { border-radius:6px; overflow:hidden; }
.card-crop-img {
  width:100%; display:block; object-fit:contain;
  image-rendering:auto; transform-origin:center center;
}
.card-crop-placeholder {
  display:flex; align-items:center; justify-content:center;
  min-height:80px; color:#9ca3af; font-size:2.5rem; opacity:0.5;
}

/* Timer & rep controls */
.card-timer-btn {
  display:flex; align-items:center; justify-content:center;
  width:32px; height:32px; border-radius:50%; border:1px solid #e5e7eb;
  background:#f9fafb; color:#6b7280; cursor:pointer; transition:all 0.15s;
}
.card-timer-btn .icon-pause { display:none; }
.card-timer-btn:hover { background:#3b82f6; color:#fff; border-color:#3b82f6; }
.expanded-card-wrapper.timing .card-timer-btn { background:#ef4444; color:#fff; border-color:#ef4444; animation:pulse-glow 2s ease-in-out infinite; }
.expanded-card-wrapper.timing .card-timer-btn .icon-play { display:none; }
.expanded-card-wrapper.timing .card-timer-btn .icon-pause { display:block; }
@keyframes pulse-glow {
  0%, 100% { box-shadow:0 0 0 0 rgba(239,68,68,0.4); }
  50% { box-shadow:0 0 0 6px rgba(239,68,68,0); }
}
.card-timer-display {
  font-size:0.85rem; font-weight:600; font-variant-numeric:tabular-nums; color:#374151;
  min-width:3rem;
}
.card-reps-label { font-size:0.75rem; color:#9ca3af; font-weight:500; }
.card-reps-count { font-size:0.85rem; font-weight:600; color:#374151; min-width:1.2rem; }
.card-rep-btn {
  padding:0.25rem 0.5rem; border:1px solid #e5e7eb; border-radius:6px;
  background:#f9fafb; font-size:0.75rem; font-weight:600; color:#6b7280;
  cursor:pointer; transition:all 0.15s;
}
.card-rep-btn:hover { background:#22c55e; color:#fff; border-color:#22c55e; }

/* Active card (practice mode) */
.expanded-card-wrapper.active-card {
  z-index:1001; position:relative;
  outline:none;
}
.expanded-card-wrapper.active-card .expanded-card {
  box-shadow:0 8px 32px rgba(0,0,0,0.15);
}

/* Inline Practice Controls (legacy — kept for active-card overlay) */
.practice-controls { display:flex; flex-direction:column; gap:0.5rem; }
.inline-control-block { display:flex; flex-direction:column; gap:0.25rem; }
.inline-control-label { font-size:0.75rem; color:#888; font-weight:500; }
.inline-timer-row { display:flex; align-items:center; gap:0.5rem; }
.inline-timer-toggle {
  padding:0.25rem 0.6rem; border:1px solid #ddd; border-radius:4px;
  background:white; font-size:0.8rem; cursor:pointer;
}
.inline-timer-display { font-size:1.1rem; font-weight:600; font-variant-numeric:tabular-nums; color:#333; }
.inline-reps-row { display:flex; align-items:center; gap:0.4rem; }
.inline-reps-count { font-size:1rem; font-weight:600; min-width:2rem; color:#333; }
.inline-reps-btn {
  padding:0.2rem 0.5rem; border:1px solid #ddd; border-radius:4px;
  background:white; font-size:0.8rem; cursor:pointer;
}
.inline-reps-btn:hover { background:#f3f4f6; }

/* Crop previews (inline stack for active mode) */
.inline-crop-stack { display:flex; flex-direction:column; gap:0.5rem; padding:0.5rem; width:100%; }
.inline-crop-image { width:100%; display:block; }
.inline-crop-loading, .inline-crop-empty {
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap:0.5rem; color:#999; font-size:0.85rem;
}
.inline-crop-placeholder { display:flex; flex-direction:column; align-items:center; gap:0.5rem; color:#999; }
.inline-btn-retry {
  padding:0.2rem 0.5rem; border:1px solid #ddd; border-radius:4px;
  background:white; font-size:0.75rem; cursor:pointer;
}
.inline-spinner {
  width:20px; height:20px;
  border:2px solid #e5e7eb; border-top-color:#3b82f6;
  border-radius:50%; animation:spin 0.8s linear infinite;
}
@keyframes spin { to { transform:rotate(360deg); } }

/* Practice backdrop */
.practice-backdrop {
  position:fixed; top:0; left:0; right:0; bottom:0;
  background:rgba(0,0,0,0.5); z-index:1000; animation:fadeIn 0.2s ease;
}
.cta-btn {
  padding:0.65rem 1.5rem; background:#3b82f6; color:white;
  border:none; border-radius:8px; font-size:0.9rem; cursor:pointer;
}
.cta-btn:hover { background:#2563eb; }

/* Dark mode song detail */
.dark-mode .song-title { color:#f5f5f7; }
.dark-mode .song-artist { color:#86868b; }
.dark-mode .meta-chip { background:#1e1e20; color:#d2d2d7; }
.dark-mode .expanded-card { background:#202020; border-color:#2a2a2c; box-shadow:0 2px 8px rgba(0,0,0,0.2), 0 1px 3px rgba(0,0,0,0.15); }
.dark-mode .expanded-card:hover { box-shadow:0 4px 16px rgba(0,0,0,0.3), 0 2px 6px rgba(0,0,0,0.15); }
.dark-mode .card-edit-pencil { background:rgba(30,30,32,0.85); border-color:rgba(255,255,255,0.08); color:#9ca3af; box-shadow:0 1px 4px rgba(0,0,0,0.2); }
.dark-mode .card-edit-pencil:hover { background:rgba(44,44,46,0.95); color:#f5f5f7; }
.dark-mode .header-icon-btn { color:#86868b; }
.dark-mode .header-icon-btn:hover { background:rgba(255,255,255,0.06); color:#f5f5f7; }
.dark-mode .header-icon-btn.active { color:#0a84ff; background:rgba(10,132,255,0.12); }
.dark-mode .card-controls-sep { background:#48484a; }
.dark-mode .card-title-name { color:#f5f5f7; }
.dark-mode .card-stage-select { background:#1e1e20; border-color:#2a2a2c; color:inherit; }
.dark-mode .card-timer-btn { background:#1e1e20; border-color:#2a2a2c; color:#f5f5f7; }
.dark-mode .card-timer-btn:hover { background:#0a84ff; color:#fff; border-color:#0a84ff; }
.dark-mode .card-timer-display { color:#f5f5f7; }
.dark-mode .card-reps-count { color:#f5f5f7; }
.dark-mode .card-rep-btn { background:#1e1e20; border-color:#2a2a2c; color:#f5f5f7; }
.dark-mode .card-rep-btn:hover { background:#30d158; border-color:#30d158; color:#fff; }
.dark-mode .card-crop-area { background:#202020; }
.dark-mode .card-crop-img { filter:invert(1); mix-blend-mode:difference; }
.dark-mode .expanded-card-wrapper.timing .card-crop-area { outline-color:#0a84ff; }
.dark-mode .header-separator { border-color:#2a2a2c; }
.dark-mode .section-line { background:#2a2a2c; }
.dark-mode .section-empty { color:#48484a; }
.dark-mode .inline-timer-display, .dark-mode .inline-reps-count { color:#f5f5f7; }
.dark-mode .inline-timer-toggle, .dark-mode .inline-reps-btn { background:#1e1e20; border-color:#2a2a2c; color:#f5f5f7; }
.dark-mode .practice-backdrop { background:rgba(0,0,0,0.65); }
.dark-mode .expanded-card-wrapper.active-card .expanded-card { box-shadow:0 8px 32px rgba(0,0,0,0.4); }
.dark-mode .inline-reps-btn:hover { background:#30d158; border-color:#30d158; color:#fff; }

@media (max-width:768px) {
  .card-controls-row { flex-wrap:wrap; gap:0.75rem; }
  .card-stat-group { margin-left:0; }
  .song-header { flex-direction:column; }
  .song-album-art { width:80px; height:80px; }
}
@media (max-width:480px) {
  .exercise-view-main {
    padding:0.75rem;
    padding-bottom:calc(5rem + env(safe-area-inset-bottom, 0px));
  }
  .song-title { font-size:1.35rem; }
  .card-controls-bar { gap:0.35rem; padding:0.5rem 0.5rem 0.25rem 0.5rem; }
  .card-controls-sep { display:none; }
  .card-stage-select { font-size:0.7rem; padding:0.2rem 0.3rem; }
  .card-timer-display { font-size:0.8rem; min-width:2.5rem; }
  .card-reps-label { font-size:0.7rem; }
  .card-reps-count { font-size:0.8rem; }
  .card-rep-btn { padding:0.2rem 0.4rem; font-size:0.7rem; }
  /* Segmented control: slightly tighter on small screens */
  .view-mode-btn { padding:0.3rem 0.6rem; font-size:0.72rem; }
  .drawer-slider { width:90px; }
}

/* ===== Plan Designer ===== */

/* Layout */
.designer-view {
  display:flex; flex-direction:column; flex:1; min-height:0; overflow:hidden;
}
.designer-columns {
  display:flex; flex:1; min-height:0; overflow:hidden;
}

/* Two-column layout */
.designer-two-col {
  display:flex; flex:1; min-height:0; overflow:hidden;
}
.col-pdf {
  flex:1; display:flex; flex-direction:column;
  min-width:0; min-height:0; background:#f9fafb; position:relative;
}
.col-editor {
  width:560px; background:#fff; border-left:none;
  display:flex; flex-direction:column; flex-shrink:0; overflow:hidden;
  position:relative; z-index:50;
  border-top:1px solid rgba(0,0,0,0.06);
}

.editor-scroll {
  flex:1; overflow-y:auto; padding:20px;
}

/* Editable metadata inputs */
.editor-title-input {
  width:100%; padding:4px 8px; margin:0 0 4px;
  font-size:1.75rem; font-weight:700; color:#1a1a1a; line-height:1.2;
  background:transparent; border:1px solid transparent; border-radius:6px;
  transition:border-color 0.15s, background 0.15s; box-sizing:border-box;
}
.editor-title-input:hover { border-color:#e5e7eb; }
.editor-title-input:focus { outline:none; border-color:#3b82f6; background:#fff; box-shadow:0 0 0 3px rgba(59,130,246,0.1); }
.editor-title-input::placeholder { color:#d1d5db; font-weight:600; }

.editor-artist-input {
  width:100%; padding:4px 8px; margin:0 0 8px;
  font-size:1rem; color:#666; background:transparent;
  border:1px solid transparent; border-radius:6px;
  transition:border-color 0.15s, background 0.15s; box-sizing:border-box;
}
.editor-artist-input:hover { border-color:#e5e7eb; }
.editor-artist-input:focus { outline:none; border-color:#3b82f6; background:#fff; box-shadow:0 0 0 3px rgba(59,130,246,0.1); }
.editor-artist-input::placeholder { color:#d1d5db; }

.editor-meta-row {
  display:flex; align-items:center; gap:8px; margin-bottom:6px; flex-wrap:wrap;
}
.editor-tempo-input {
  width:80px; padding:4px 8px; font-size:0.85rem; font-weight:500;
  background:transparent; border:1px solid #e5e7eb; border-radius:6px; color:#555;
  transition:border-color 0.15s; box-sizing:border-box;
}
.editor-tempo-input:focus { outline:none; border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59,130,246,0.1); }
.editor-tempo-label { font-size:0.8rem; color:#9ca3af; font-weight:500; }
.editor-link-input {
  flex:1; min-width:120px; padding:4px 8px; font-size:0.8rem;
  background:transparent; border:1px solid #e5e7eb; border-radius:6px; color:#555;
  transition:border-color 0.15s; box-sizing:border-box;
}
.editor-link-input:focus { outline:none; border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59,130,246,0.1); }
.editor-link-input::placeholder { color:#d1d5db; }

.editor-meta-section { margin-bottom:16px; }
.editor-structure-section { margin-bottom:16px; }
.editor-exercises-header {
  display:flex; align-items:center; gap:8px; margin-bottom:12px;
}
.editor-exercises-header h4 {
  margin:0; font-size:0.8125rem; font-weight:700;
  text-transform:uppercase; letter-spacing:0.05em; color:#6b7280;
}

/* Editable title input (plan designer cards) */
.card-title-edit {
  width:100%; padding:2px 6px; font-size:0.9rem; font-weight:600; color:#1d1d1f;
  background:transparent; border:1px solid transparent; border-radius:4px;
  transition:border-color 0.15s; box-sizing:border-box;
}
.card-title-edit:hover { border-color:#e5e7eb; }
.card-title-edit:focus { outline:none; border-color:#3b82f6; background:#fff; box-shadow:0 0 0 2px rgba(59,130,246,0.1); }
.card-title-edit::placeholder { color:#d1d5db; font-weight:400; font-style:italic; }

/* Section select (plan designer cards) */
.card-section-select {
  padding:3px 6px; border:1px solid #e5e7eb; border-radius:6px;
  font-size:0.75rem; font-weight:500; background:#fff; color:#374151;
  cursor:pointer; transition:border-color 0.15s; flex-shrink:0;
}
.card-section-select:focus { outline:none; border-color:#3b82f6; }

/* Delete button (plan designer cards) */
.card-delete-btn {
  margin-left:auto; padding:2px 8px; font-size:0.7rem;
  color:#dc2626; background:none; border:1px solid #fecaca;
  border-radius:5px; cursor:pointer; transition:all 0.15s; flex-shrink:0;
}
.card-delete-btn:hover { background:#fef2f2; }

/* Section nav inside plan designer sidebar */
.pd-section-nav { margin-bottom:0.75rem; }

/* Resize handles */
.col-resize-handle {
  width:8px; flex-shrink:0; cursor:col-resize;
  position:relative; z-index:20;
  background:linear-gradient(to right, #d1d5db 1px, #e5e7eb 1px, #e5e7eb calc(100% - 1px), #d1d5db calc(100% - 1px));
  transition:background 0.15s;
  user-select:none; -webkit-user-select:none;
}
.col-resize-handle::after {
  content:''; position:absolute; left:50%; top:50%;
  transform:translate(-50%,-50%);
  width:2px; height:24px; background:#9ca3af; border-radius:1px;
  transition:background 0.15s;
}
.col-resize-handle:hover {
  background:linear-gradient(to right, #9ca3af 1px, #f3f4f6 1px, #f3f4f6 calc(100% - 1px), #9ca3af calc(100% - 1px));
}
.col-resize-handle:hover::after {
  background:#6b7280;
}

/* Left Column */
.col-left {
  width:380px; background:#fff; border-right:none;
  display:flex; flex-direction:column; flex-shrink:0; overflow:hidden;
}
.col-left-header {
  padding:10px 16px; border-bottom:1px solid #e5e7eb; flex-shrink:0;
}
.back-link {
  display:inline-block; width:100%; text-align:center;
  font-size:0.8125rem; color:#6b7280; text-decoration:none;
  padding:6px 0 2px; transition:color 0.15s;
}
.back-link:hover { color:#374151; }
.sidebar-content { flex:1; overflow-y:auto; padding:16px; }

.form-section { margin-bottom:24px; }
.form-section-title {
  margin:0 0 12px; font-size:0.8125rem; font-weight:700;
  text-transform:uppercase; letter-spacing:0.05em; color:#6b7280;
}
.form-group { margin-bottom:14px; }
.form-label {
  display:flex; align-items:center; gap:6px;
  font-size:0.8125rem; font-weight:600; color:#374151; margin-bottom:4px;
}
.required { color:#dc2626; }
.optional-tag { font-size:0.6875rem; font-weight:400; color:#9ca3af; }
.form-input {
  width:100%; padding:8px 10px; font-size:0.8125rem;
  border:1px solid #d1d5db; border-radius:6px; background:#fff; color:#1f2937;
  transition:all 0.15s; box-sizing:border-box;
}
.form-input:focus {
  outline:none; border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59,130,246,0.1);
}
.form-input::placeholder { color:#9ca3af; }
.title-input { font-size:0.9375rem; font-weight:600; }
.tempo-input { max-width:120px; }

/* Quick Add */
.quick-add-row { display:flex; flex-wrap:wrap; gap:6px; margin-bottom:12px; }
.quick-add-btn {
  padding:5px 10px; font-size:0.75rem; font-weight:500;
  border:1px solid #d1d5db; border-radius:14px; background:#fff; color:#374151;
  cursor:pointer; transition:all 0.15s;
}
.quick-add-btn:hover { background:#f3f4f6; border-color:#3b82f6; color:#3b82f6; }
.quick-add-btn.custom-btn { border-style:dashed; color:#6b7280; }

.custom-input-row { display:flex; align-items:center; gap:6px; margin-bottom:12px; }
.custom-name-input { flex:1; }

/* Structure list */
.structure-list {
  border:1px solid #e5e7eb; border-radius:8px; overflow:hidden; background:#fff;
}
.structure-row {
  display:flex; align-items:center; gap:8px;
  padding:8px 10px; border-bottom:1px solid #f3f4f6; cursor:grab;
}
.structure-row:last-child { border-bottom:none; }
.drag-handle {
  color:#9ca3af; font-size:0.875rem; cursor:grab; user-select:none; flex-shrink:0;
}
.section-label-text {
  flex:1; font-size:0.8125rem; font-weight:500; color:#374151;
}
.remove-btn {
  background:none; border:none; color:#d1d5db; cursor:pointer;
  font-size:0.8125rem; transition:color 0.15s; padding:2px 4px;
}
.remove-btn:hover { color:#dc2626; }
.structure-empty {
  text-align:center; padding:16px; color:#9ca3af; font-size:0.8125rem;
}

/* Auto-fill */
.auto-fill-section { margin-bottom:16px; }
.auto-fill-btn {
  width:100%; display:flex; align-items:center; justify-content:center;
  gap:8px; padding:10px 16px; font-size:0.8125rem; font-weight:600; color:#fff;
  background:linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
  border:none; border-radius:8px; cursor:pointer; transition:all 0.2s ease;
  box-shadow:0 1px 3px rgba(109,40,217,0.3);
}
.auto-fill-btn:hover:not(:disabled) {
  background:linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
  box-shadow:0 2px 6px rgba(109,40,217,0.4); transform:translateY(-1px);
}
.auto-fill-btn:active:not(:disabled) { transform:translateY(0); }
.auto-fill-btn:disabled { opacity:0.7; cursor:not-allowed; }
.auto-fill-error {
  display:block; margin-top:6px; font-size:0.75rem; color:#dc2626;
}
.auto-fill-info {
  display:block; margin-top:6px; font-size:0.75rem; color:#6b7280;
}

/* Center Column: PDF */
.col-center {
  flex:1; display:flex; flex-direction:column;
  min-width:0; min-height:0; background:#f9fafb; position:relative;
}
.upload-zone {
  flex:1; display:flex; align-items:center; justify-content:center;
  margin:24px; border:2px dashed #d1d5db; border-radius:16px;
  background:#fff; transition:all 0.2s;
}
.upload-zone.drag-over { border-color:#3b82f6; background:#eff6ff; }
.upload-content { text-align:center; padding:48px; }
.upload-icon { font-size:64px; margin-bottom:16px; opacity:0.5; }
.upload-content p { margin:0 0 16px; color:#6b7280; }

.upload-progress-area, .upload-error-bar {
  display:flex; align-items:center; justify-content:center; gap:12px; padding:24px; flex:1;
}
.upload-error-bar { flex-direction:column; color:#dc2626; }

.pages-scroll {
  flex:1; overflow:auto; padding:24px; position:relative; cursor:crosshair;
  scrollbar-width:none; -ms-overflow-style:none;
}
.pages-scroll::-webkit-scrollbar { display:none; }
.page-stack {
  display:flex; flex-direction:column; align-items:center; gap:0;
  margin:0 auto;
}
.page-wrapper {
  position:relative; display:flex; flex-direction:column; align-items:center;
}
.page-label {
  position:absolute; top:8px; left:8px; padding:4px 10px;
  background:rgba(0,0,0,0.6); color:#fff; font-size:0.75rem;
  font-weight:500; border-radius:6px; z-index:5;
}
.page-loading, .page-error {
  display:flex; align-items:center; justify-content:center; gap:8px;
  padding:48px; background:#fff; border:1px dashed #d1d5db;
  border-radius:8px; color:#6b7280; font-size:0.875rem;
  min-width:400px; min-height:500px;
}
.page-error { color:#dc2626; background:#fef2f2; border-color:#fecaca; }
.page-image-container { position:relative; display:inline-block; }
.page-image-container img.page-image {
  display:block; max-width:100%; height:auto;
  box-shadow:0 2px 8px rgba(0,0,0,0.1); user-select:none; touch-action:none;
}

/* Crop overlays */
.crop-overlay {
  position:absolute; border:2px solid rgba(59,130,246,0.6);
  background:rgba(59,130,246,0.15); cursor:pointer; z-index:6;
  transition:all 0.15s; box-sizing:border-box;
}
.crop-overlay:hover { background:rgba(59,130,246,0.25); }
.crop-overlay.selected {
  border-width:3px; border-color:rgba(59,130,246,0.9);
  background:rgba(59,130,246,0.3); box-shadow:0 0 0 2px rgba(59,130,246,0.2);
}
.crop-overlay.complete {
  border-color:rgba(34,197,94,0.6); background:rgba(34,197,94,0.15);
}
.crop-overlay.complete:hover { background:rgba(34,197,94,0.25); }
.crop-overlay.complete.selected {
  border-color:rgba(34,197,94,0.9); background:rgba(34,197,94,0.3);
  box-shadow:0 0 0 2px rgba(34,197,94,0.2);
}
.overlay-badge {
  position:absolute; top:-1px; left:-1px; width:20px; height:20px;
  display:flex; align-items:center; justify-content:center;
  font-size:0.625rem; font-weight:700; color:#fff;
  background:rgba(59,130,246,0.85); border-radius:0 0 6px 0; line-height:1;
}
.crop-overlay.complete .overlay-badge { background:rgba(34,197,94,0.85); }

.selection-rect {
  position:absolute; border:2px dashed #3b82f6;
  background:rgba(59,130,246,0.1); box-sizing:border-box;
  pointer-events:none; z-index:10;
}

/* Zoom controls */
.zoom-controls {
  position:absolute; bottom:16px; left:16px;
  display:flex; align-items:center; gap:8px; padding:8px;
  background:#fff; border-radius:8px;
  box-shadow:0 2px 8px rgba(0,0,0,0.15); z-index:15;
}
.zoom-btn {
  width:32px; height:32px; display:flex; align-items:center; justify-content:center;
  font-size:1.25rem; font-weight:600; color:#374151; background:#f3f4f6;
  border:1px solid #e5e7eb; border-radius:6px; cursor:pointer; transition:all 0.15s;
}
.zoom-btn:hover { background:#e5e7eb; }
.zoom-level {
  font-size:0.875rem; font-weight:600; color:#374151; min-width:48px; text-align:center;
}
.hint {
  position:absolute; bottom:16px; left:50%; transform:translateX(-50%);
  padding:10px 20px; background:rgba(0,0,0,0.7); color:#fff;
  font-size:0.875rem; border-radius:20px; pointer-events:none; z-index:20; white-space:nowrap;
}

/* Right Column */
.col-right {
  width:380px; background:#fff; border-left:none;
  display:flex; flex-direction:column; flex-shrink:0; overflow:hidden;
}
.right-sidebar-content {
  flex:1; display:flex; flex-direction:column; overflow:hidden;
}
.right-sidebar-header {
  display:flex; align-items:center; justify-content:space-between;
  padding:12px 16px; border-bottom:1px solid #e5e7eb; flex-shrink:0;
}
.right-sidebar-title {
  margin:0; font-size:0.8125rem; font-weight:700;
  text-transform:uppercase; letter-spacing:0.05em; color:#6b7280;
}
.progress-badge {
  padding:2px 8px; background:#fef3c7; color:#92400e;
  font-size:0.6875rem; font-weight:600; border-radius:10px;
}
.progress-badge.complete { background:#dcfce7; color:#166534; }

.right-sidebar-empty {
  flex:1; display:flex; flex-direction:column; align-items:center;
  justify-content:center; padding:32px 16px; text-align:center; color:#6b7280;
}
.right-sidebar-empty .empty-icon { font-size:36px; margin-bottom:8px; opacity:0.5; }
.right-sidebar-empty p { margin:0 0 4px; font-weight:500; color:#374151; font-size:0.875rem; }
.empty-hint { font-size:0.8125rem; }

.card-list { flex:1; overflow-y:auto; padding:8px; }

/* Exercise cards */
.exercise-card {
  background:#f9fafb; border:1px solid #e5e7eb; border-radius:8px;
  margin-bottom:6px; cursor:pointer; transition:all 0.15s; overflow:hidden;
}
.exercise-card.incomplete { border-left:3px solid #f59e0b; }
.exercise-card.complete { border-left:3px solid #22c55e; }
.exercise-card:hover { border-color:#d1d5db; }
.exercise-card.selected {
  border-color:#3b82f6; box-shadow:0 0 0 2px rgba(59,130,246,0.1);
}

.card-collapsed {
  display:flex; align-items:center; gap:8px; padding:8px 10px;
}
.card-number {
  font-size:0.75rem; font-weight:700; color:#6b7280; flex-shrink:0; min-width:20px;
}
.card-thumb-small {
  width:40px; height:28px; border-radius:4px; overflow:hidden;
  background:#e5e7eb; flex-shrink:0;
}
.card-thumb-small img { width:100%; height:100%; object-fit:cover; }
.card-name {
  flex:1; font-size:0.8125rem; font-weight:500; color:#1f2937;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis; min-width:0;
}
.unnamed { color:#9ca3af; font-style:italic; font-weight:400; }
.card-status { flex-shrink:0; }
.status-dot-complete { color:#22c55e; font-size:0.75rem; font-weight:700; }
.status-dot-incomplete { color:#f59e0b; font-size:0.5rem; }

.card-expanded {
  padding:10px; border-top:1px solid #e5e7eb; cursor:default;
}
.card-thumb-large {
  position:relative; width:100%; max-height:160px; border-radius:6px;
  overflow:hidden; background:#e5e7eb; margin-bottom:10px;
}
.card-thumb-large img {
  width:100%; max-height:160px; object-fit:contain; object-position:top center;
}
.thumb-page-label {
  position:absolute; top:4px; left:4px; padding:2px 6px;
  background:rgba(0,0,0,0.6); color:#fff; font-size:0.625rem; border-radius:4px;
}

.field-group { margin-bottom:10px; }
.field-label {
  display:block; font-size:0.75rem; font-weight:600; color:#374151; margin-bottom:3px;
}
.field-input, .field-select {
  width:100%; padding:6px 8px; font-size:0.8125rem;
  border:1px solid #d1d5db; border-radius:6px; background:#fff; color:#1f2937;
  transition:all 0.15s; box-sizing:border-box;
}
.field-input:focus, .field-select:focus {
  outline:none; border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59,130,246,0.1);
}
.field-input::placeholder { color:#9ca3af; }

.difficulty-picker { display:flex; gap:4px; margin-bottom:2px; }
.difficulty-btn {
  width:30px; height:30px; display:flex; align-items:center; justify-content:center;
  font-size:0.75rem; font-weight:600; border:1px solid #d1d5db; border-radius:6px;
  background:#fff; color:#6b7280; cursor:pointer; transition:all 0.15s;
}
.difficulty-btn:hover { border-color:#3b82f6; color:#3b82f6; }
.difficulty-btn.selected { background:#3b82f6; color:#fff; border-color:#3b82f6; }
.difficulty-hint { font-size:0.6875rem; color:#6b7280; }
.difficulty-hint.muted { color:#9ca3af; }

.delete-btn {
  width:100%; padding:6px; margin-top:8px; font-size:0.75rem;
  color:#dc2626; background:none; border:1px solid #fecaca;
  border-radius:6px; cursor:pointer; transition:all 0.15s;
}
.delete-btn:hover { background:#fef2f2; }

/* Footer */
.col-right-footer {
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap:8px; padding:12px 16px; border-top:1px solid #e5e7eb; flex-shrink:0;
}
.save-error {
  font-size:0.75rem; color:#dc2626; max-width:140px;
  overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
}
.save-hint { font-size:0.875rem; color:#f59e0b; cursor:help; }
.save-btn {
  width:100%; display:flex; align-items:center; justify-content:center;
  gap:6px; padding:10px 16px; font-size:0.875rem; font-weight:500;
  border-radius:6px; cursor:pointer; border:1px solid #d1d5db;
  background:#f3f4f6; color:#374151; transition:background 0.15s, border-color 0.15s;
}
.save-btn:hover:not(:disabled) { background:#e5e7eb; border-color:#9ca3af; }
.save-btn:disabled { opacity:0.4; cursor:not-allowed; }

/* Shared buttons */
.btn {
  padding:8px 16px; font-size:0.875rem; font-weight:500; border-radius:8px;
  cursor:pointer; transition:all 0.15s; background:#f3f4f6;
  color:#374151; border:1px solid #e5e7eb;
}
.btn:hover { background:#e5e7eb; }
.btn:disabled { opacity:0.5; cursor:not-allowed; }
.btn.primary {
  background:linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color:#fff; border:none;
}
.btn.primary:hover:not(:disabled) {
  background:linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
}
.btn.small { padding:4px 10px; font-size:0.75rem; }
.btn.danger { background:#dc2626; color:#fff; border:none; }
.btn.danger:hover { background:#b91c1c; }

.spinner {
  width:20px; height:20px; border:2px solid #e5e7eb; border-top-color:#3b82f6;
  border-radius:50%; animation:spin 0.8s linear infinite; display:inline-block;
}
.spinner-small {
  display:inline-block; width:14px; height:14px;
  border:2px solid rgba(255,255,255,0.3); border-top-color:#fff;
  border-radius:50%; animation:spin 0.6s linear infinite;
}

/* Discard dialog */
.dialog-overlay {
  position:fixed; inset:0; background:rgba(0,0,0,0.5);
  display:flex; align-items:center; justify-content:center; z-index:100;
}
.dialog {
  background:#fff; border-radius:16px; padding:24px;
  max-width:400px; width:90%; box-shadow:0 20px 40px rgba(0,0,0,0.2);
}
.dialog h3 { margin:0 0 8px; font-size:1.125rem; color:#1f2937; }
.dialog p { margin:0 0 24px; color:#6b7280; }
.dialog-actions { display:flex; gap:12px; justify-content:flex-end; }

/* Dark mode plan designer */
.dark-mode .col-left { background:#141416; }
.dark-mode .col-left-header { border-color:#2a2a2c; }
.dark-mode .col-center, .dark-mode .col-pdf { background:#000000; }
.dark-mode .col-right, .dark-mode .col-editor { background:#141416; border-top-color:rgba(255,255,255,0.04); }
.dark-mode .col-right-footer { border-color:#2a2a2c; }
.dark-mode .editor-title-input { color:#f5f5f7; }
.dark-mode .editor-title-input:hover { border-color:#2a2a2c; }
.dark-mode .editor-title-input:focus { border-color:#0a84ff; background:#1e1e20; }
.dark-mode .editor-title-input::placeholder { color:#48484a; }
.dark-mode .editor-artist-input { color:#86868b; }
.dark-mode .editor-artist-input:hover { border-color:#2a2a2c; }
.dark-mode .editor-artist-input:focus { border-color:#0a84ff; background:#1e1e20; }
.dark-mode .editor-artist-input::placeholder { color:#48484a; }
.dark-mode .editor-tempo-input { background:#1e1e20; border-color:#2a2a2c; color:#d2d2d7; }
.dark-mode .editor-link-input { background:#1e1e20; border-color:#2a2a2c; color:#d2d2d7; }
.dark-mode .editor-link-input::placeholder { color:#48484a; }
.dark-mode .card-title-edit { color:#f5f5f7; }
.dark-mode .card-title-edit:hover { border-color:#2a2a2c; }
.dark-mode .card-title-edit:focus { border-color:#0a84ff; background:#1e1e20; }
.dark-mode .card-title-edit::placeholder { color:#48484a; }
.dark-mode .card-section-select { background:#1e1e20; border-color:#2a2a2c; color:#f5f5f7; }
.dark-mode .card-delete-btn { border-color:#5c2020; color:#ff6961; }
.dark-mode .card-delete-btn:hover { background:#3a1c1c; }
.dark-mode .col-resize-handle {
  background:linear-gradient(to right, #48484a 1px, #141416 1px, #141416 calc(100% - 1px), #48484a calc(100% - 1px));
}
.dark-mode .col-resize-handle::after { background:#636366; }
.dark-mode .col-resize-handle:hover {
  background:linear-gradient(to right, #636366 1px, #1e1e20 1px, #1e1e20 calc(100% - 1px), #636366 calc(100% - 1px));
}
.dark-mode .col-resize-handle:hover::after { background:#86868b; }
.dark-mode .form-section-title,
.dark-mode .right-sidebar-title { color:#86868b; }
.dark-mode .form-label, .dark-mode .field-label { color:#d2d2d7; }
.dark-mode .form-input, .dark-mode .field-input, .dark-mode .field-select {
  background:#1e1e20; border-color:#2a2a2c; color:#f5f5f7;
}
.dark-mode .structure-list { background:#1e1e20; border-color:#2a2a2c; }
.dark-mode .section-label-text { color:#f5f5f7; }
.dark-mode .structure-row { border-color:#2a2a2c; }
.dark-mode .quick-add-btn { background:#1e1e20; border-color:#2a2a2c; color:#f5f5f7; }
.dark-mode .auto-fill-btn {
  background:linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
  box-shadow:0 1px 3px rgba(91,33,182,0.4);
}
.dark-mode .auto-fill-btn:hover:not(:disabled) {
  background:linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%);
}
.dark-mode .auto-fill-error { color:#ff6961; }
.dark-mode .auto-fill-info { color:#9ca3af; }
.dark-mode .save-btn { background:#1e1e20; border-color:#2a2a2c; color:#f5f5f7; }
.dark-mode .save-btn:hover:not(:disabled) { background:#2a2a2c; border-color:#48484a; }
.dark-mode .exercise-card { background:#141416; border-color:#2a2a2c; }
.dark-mode .card-name { color:#f5f5f7; }
.dark-mode .right-sidebar-header { border-color:#2a2a2c; }
.dark-mode .card-expanded { border-color:#2a2a2c; }
.dark-mode .back-link { color:#86868b; }
.dark-mode .dialog { background:#141416; }
.dark-mode .dialog h3 { color:#f5f5f7; }
.dark-mode .dialog p { color:#86868b; }
.dark-mode .upload-zone { background:#141416; border-color:#2a2a2c; }
.dark-mode .zoom-controls { background:#141416; box-shadow:0 2px 8px rgba(0,0,0,0.3); }
.dark-mode .zoom-btn { background:#1e1e20; border-color:#2a2a2c; color:#f5f5f7; }
.dark-mode .zoom-level { color:#f5f5f7; }
.dark-mode .difficulty-btn { background:#1e1e20; border-color:#2a2a2c; color:#86868b; }
.dark-mode .btn { background:#1e1e20; border-color:#2a2a2c; color:#f5f5f7; }
.dark-mode .right-sidebar-empty p { color:#f5f5f7; }

/* Plan Designer: WYSIWYG Header */
.pd-header { margin-bottom:12px; }
.pd-header .song-title { margin-bottom:0.15rem; }
.pd-editable { cursor:pointer; position:relative; }
.pd-edit-icon {
  font-size:0.7em; opacity:0; margin-left:0.35em;
  transition:opacity 0.15s; color:#9ca3af;
}
.pd-editable:hover .pd-edit-icon { opacity:1; }
.pd-placeholder { color:#9ca3af; font-style:italic; }
.pd-inline-input {
  font:inherit; color:inherit; background:transparent;
  border:1px solid #3b82f6; border-radius:4px;
  padding:2px 6px; outline:none; width:100%;
  box-shadow:0 0 0 2px rgba(59,130,246,0.15);
}
.pd-inline-input[type="number"] { width:80px; }
.pd-inline-input[type="url"] { font-size:0.8rem; }

/* Plan Designer: Section pill controls */
.pd-section-pill-wrap { position:relative; display:inline-flex; }
.pd-pill-remove {
  position:absolute; top:-6px; right:-6px;
  width:16px; height:16px; border-radius:50%;
  background:#dc2626; color:#fff; font-size:0.6rem;
  display:none; align-items:center; justify-content:center;
  cursor:pointer; border:none; line-height:1;
}
.pd-section-pill-wrap:hover .pd-pill-remove { display:flex; }
.pd-add-section-pill {
  border:1px dashed #9ca3af; background:transparent;
  color:#9ca3af; cursor:pointer;
}
.pd-add-section-pill:hover { border-color:#3b82f6; color:#3b82f6; }

/* Plan Designer: Section add popover */
.pd-section-popover {
  display:flex; flex-wrap:wrap; gap:6px; padding:10px;
  background:#f9fafb; border:1px solid #e5e7eb; border-radius:10px;
  margin-bottom:12px; animation:slideUp 0.15s ease;
}
.pd-custom-row-inline {
  display:flex; align-items:center; gap:6px; width:100%;
}
.pd-popover-done {
  margin-left:auto; color:#3b82f6; border-color:#3b82f6; font-weight:600;
}
.pd-popover-done:hover { background:rgba(59,130,246,0.08); }

/* Show resize handles always in plan designer */
.pd-resize-handle { display:flex !important; }

/* Dark mode WYSIWYG header */
.dark-mode .pd-placeholder { color:#48484a; }
.dark-mode .pd-edit-icon { color:#636366; }
.dark-mode .pd-inline-input { color:#f5f5f7; border-color:#0a84ff; box-shadow:0 0 0 2px rgba(10,132,255,0.15); }
.dark-mode .pd-pill-remove { background:#ff453a; }
.dark-mode .pd-add-section-pill { border-color:#48484a; color:#636366; }
.dark-mode .pd-add-section-pill:hover { border-color:#0a84ff; color:#0a84ff; }
.dark-mode .pd-section-popover { background:#141416; border-color:#2a2a2c; }

/* Horizontal (row) resize handle for mobile plan designer */
.row-resize-handle {
  display:none;
  height:8px; flex-shrink:0; cursor:row-resize;
  position:relative; z-index:20;
  background:linear-gradient(to bottom, #d1d5db 1px, #e5e7eb 1px, #e5e7eb calc(100% - 1px), #d1d5db calc(100% - 1px));
  transition:background 0.15s;
  user-select:none; -webkit-user-select:none;
  touch-action:none;
  align-items:center; justify-content:center;
}
.row-resize-handle::after {
  content:''; display:block;
  width:24px; height:2px; background:#9ca3af; border-radius:1px;
  transition:background 0.15s;
}
.row-resize-handle:hover {
  background:linear-gradient(to bottom, #9ca3af 1px, #f3f4f6 1px, #f3f4f6 calc(100% - 1px), #9ca3af calc(100% - 1px));
}
.row-resize-handle:hover::after { background:#6b7280; }
.dark-mode .row-resize-handle {
  background:linear-gradient(to bottom, #48484a 1px, #141416 1px, #141416 calc(100% - 1px), #48484a calc(100% - 1px));
}
.dark-mode .row-resize-handle::after { background:#636366; }
.dark-mode .row-resize-handle:hover {
  background:linear-gradient(to bottom, #636366 1px, #1e1e20 1px, #1e1e20 calc(100% - 1px), #636366 calc(100% - 1px));
}
.dark-mode .row-resize-handle:hover::after { background:#86868b; }

/* Responsive plan designer */
@media (max-width:900px) {
  .designer-columns { flex-direction:column; }
  .col-left { width:100%; border-right:none; border-bottom:1px solid #e5e7eb; max-height:250px; }
  .col-right { width:100%; border-left:none; border-top:1px solid #e5e7eb; }
  .designer-two-col { flex-direction:column-reverse; }
  .col-pdf { min-height:0; flex:none; height:40%; }
  .col-editor { width:100%; flex:none; height:calc(60% - 8px); border-top:none; border-bottom:none; }
  .col-resize-handle { display:none; }
  .row-resize-handle { display:flex; }
}

/* ===== Settings Page ===== */
.settings-page {
  max-width:1400px; width:100%; margin:0 auto;
  padding:2.5rem 4rem 4rem;
}
.settings-page-title {
  margin:0 0 1.75rem; font-size:1.75rem; font-weight:700;
  color:#1d1d1f; letter-spacing:-0.025em;
}

/* Cards */
.settings-card {
  background:#f5f5f7; border-radius:14px; padding:1.5rem 1.75rem;
  margin-bottom:1rem;
}
.settings-card-muted { background:#f0f0f2; }
.settings-card-title {
  margin:0 0 1rem; font-size:1.05rem; font-weight:650; color:#1d1d1f;
}
.settings-card-subtitle {
  margin:0 0 0.25rem; font-size:0.95rem; font-weight:600; color:#1d1d1f;
}
.settings-card-desc {
  margin:0 0 1rem; font-size:0.82rem; color:#6b7280; line-height:1.4;
}
.settings-card-title + .settings-card-desc { margin-top:-0.5rem; }
.settings-divider {
  border:none; border-top:1px solid rgba(0,0,0,0.06);
  margin:1.25rem 0;
}

/* Profile header with avatar */
.settings-profile-header {
  display:flex; align-items:center; gap:1.25rem; margin-bottom:1.25rem;
}
.settings-avatar {
  width:72px; height:72px; border-radius:50%;
  background:linear-gradient(135deg, #6366f1, #8b5cf6);
  display:flex; align-items:center; justify-content:center;
  flex-shrink:0; overflow:hidden; position:relative;
}
.settings-avatar-initials {
  font-size:1.6rem; font-weight:700; color:#fff;
  text-transform:uppercase; line-height:1;
}
.settings-avatar img {
  width:100%; height:100%; object-fit:cover;
  position:absolute; inset:0;
}
.settings-avatar-actions {
  display:flex; flex-direction:column; gap:0.4rem;
}
.settings-hint {
  font-size:0.75rem; color:#9ca3af;
}

/* Field rows */
.settings-field { margin-bottom:0.85rem; }
.settings-field:last-child { margin-bottom:0; }
.settings-field-row {
  display:flex; gap:0.75rem;
}
.settings-field-half { flex:1; min-width:0; }
.settings-field-label {
  display:block; font-size:0.78rem; font-weight:600; color:#374151;
  margin-bottom:0.35rem; letter-spacing:0.01em;
}

/* Inputs */
.settings-field-input {
  width:100%; padding:0.6rem 0.8rem; font-size:0.9rem;
  border:1px solid #d1d5db; border-radius:8px; background:#fff; color:#1d1d1f;
  transition:all 0.15s; box-sizing:border-box;
}
.settings-field-input:focus {
  outline:none; border-color:#6366f1; box-shadow:0 0 0 3px rgba(99,102,241,0.12);
}
.settings-field-input:disabled {
  opacity:0.5; cursor:not-allowed;
}

/* Selects */
.settings-field-select {
  width:100%; padding:0.6rem 0.8rem; font-size:0.9rem;
  border:1px solid #d1d5db; border-radius:8px; background:#fff; color:#1d1d1f;
  transition:all 0.15s; box-sizing:border-box;
  appearance:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b7280' d='M3 4.5L6 7.5L9 4.5'/%3E%3C/svg%3E");
  background-repeat:no-repeat; background-position:right 0.75rem center;
  padding-right:2rem;
}
.settings-field-select:disabled { opacity:0.5; cursor:not-allowed; }
.settings-select-row {
  display:flex; align-items:center; gap:0.6rem;
}
.settings-select-row .settings-field-select { flex:1; }

/* Badges */
.settings-badge-soon {
  font-size:0.65rem; font-weight:600; text-transform:uppercase;
  letter-spacing:0.04em; color:#8b5cf6; background:rgba(139,92,246,0.1);
  padding:0.2rem 0.5rem; border-radius:6px; white-space:nowrap;
}

/* Buttons */
.settings-btn-secondary {
  padding:0.45rem 1rem; font-size:0.82rem; font-weight:500;
  border:1px solid #d1d5db; border-radius:8px;
  background:#fff; color:#374151; cursor:pointer;
  transition:all 0.15s; white-space:nowrap;
}
.settings-btn-secondary:hover:not(:disabled) {
  background:#f3f4f6; border-color:#9ca3af;
}
.settings-btn-secondary:disabled { opacity:0.45; cursor:not-allowed; }

.settings-btn-danger {
  padding:0.45rem 1rem; font-size:0.82rem; font-weight:500;
  border:1px solid #fca5a5; border-radius:8px;
  background:#fef2f2; color:#dc2626; cursor:pointer;
  transition:all 0.15s; white-space:nowrap;
}
.settings-btn-danger:hover:not(:disabled) {
  background:#fee2e2; border-color:#f87171;
}
.settings-btn-danger:disabled { opacity:0.45; cursor:not-allowed; }
.settings-danger-text { color:#dc2626 !important; }

/* Integrations */
.settings-integration {
  display:flex; align-items:center; gap:0.85rem;
  padding:0.75rem 0; border-bottom:1px solid rgba(0,0,0,0.04);
}
.settings-integration:last-child { border-bottom:none; padding-bottom:0; }
.settings-integration:first-of-type { padding-top:0; }
.settings-integration-icon {
  font-size:1.5rem; width:40px; height:40px;
  display:flex; align-items:center; justify-content:center;
  background:rgba(0,0,0,0.04); border-radius:10px; flex-shrink:0;
}
.settings-integration-info { flex:1; min-width:0; }
.settings-integration-name {
  display:block; font-size:0.9rem; font-weight:600; color:#1d1d1f;
}
.settings-integration-status {
  display:block; font-size:0.78rem; color:#9ca3af;
}

/* Data rows */
.settings-data-row {
  display:flex; align-items:center; justify-content:space-between; gap:1rem;
}
.settings-data-label {
  display:block; font-size:0.9rem; font-weight:500; color:#1d1d1f;
}
.settings-data-desc {
  display:block; font-size:0.78rem; color:#9ca3af; margin-top:0.15rem;
}

/* About */
.settings-about {
  text-align:center; padding:0.5rem 0;
}
.settings-about-name {
  display:block; font-size:1rem; font-weight:700; color:#1d1d1f;
  letter-spacing:-0.01em;
}
.settings-about-version {
  display:block; font-size:0.78rem; color:#9ca3af; margin-top:0.15rem;
}
.settings-about-tagline {
  display:block; font-size:0.8rem; color:#6b7280; margin-top:0.5rem;
  font-style:italic;
}

/* Dark mode settings page */
.dark-mode .settings-page-title { color:#f5f5f7; }
.dark-mode .settings-card { background:#141416; }
.dark-mode .settings-card-muted { background:#111113; }
.dark-mode .settings-card-title { color:#f5f5f7; }
.dark-mode .settings-card-subtitle { color:#f5f5f7; }
.dark-mode .settings-card-desc { color:#86868b; }
.dark-mode .settings-field-label { color:#d2d2d7; }
.dark-mode .settings-field-input {
  background:#1e1e20; border-color:#2a2a2c; color:#f5f5f7;
}
.dark-mode .settings-field-input:focus {
  border-color:#818cf8; box-shadow:0 0 0 3px rgba(99,102,241,0.15);
}
.dark-mode .settings-field-select {
  background:#1e1e20; border-color:#2a2a2c; color:#f5f5f7;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2386868b' d='M3 4.5L6 7.5L9 4.5'/%3E%3C/svg%3E");
}
.dark-mode .settings-divider { border-top-color:rgba(255,255,255,0.06); }
.dark-mode .settings-hint { color:#636366; }
.dark-mode .settings-badge-soon {
  color:#a78bfa; background:rgba(139,92,246,0.15);
}
.dark-mode .settings-btn-secondary {
  background:#1e1e20; border-color:#2a2a2c; color:#d2d2d7;
}
.dark-mode .settings-btn-secondary:hover:not(:disabled) {
  background:#2a2a2c; border-color:#3a3a3c;
}
.dark-mode .settings-btn-danger {
  background:rgba(220,38,38,0.1); border-color:rgba(220,38,38,0.25); color:#f87171;
}
.dark-mode .settings-btn-danger:hover:not(:disabled) {
  background:rgba(220,38,38,0.15); border-color:rgba(248,113,113,0.35);
}
.dark-mode .settings-danger-text { color:#f87171 !important; }
.dark-mode .settings-integration { border-bottom-color:rgba(255,255,255,0.04); }
.dark-mode .settings-integration-icon { background:rgba(255,255,255,0.05); }
.dark-mode .settings-integration-name { color:#f5f5f7; }
.dark-mode .settings-integration-status { color:#636366; }
.dark-mode .settings-data-label { color:#f5f5f7; }
.dark-mode .settings-data-desc { color:#636366; }
.dark-mode .settings-about-name { color:#f5f5f7; }
.dark-mode .settings-about-version { color:#636366; }
.dark-mode .settings-about-tagline { color:#86868b; }

@media (max-width:480px) {
  .settings-page {
    padding:1.5rem 1rem;
    padding-bottom:calc(1.5rem + env(safe-area-inset-bottom, 0px));
  }
  .settings-field-row { flex-direction:column; }
  .settings-profile-header { flex-direction:column; text-align:center; }
  .settings-avatar-actions { align-items:center; }
}

/* ===== Dark mode selection ===== */
.dark-mode ::selection { background:#0a84ff; color:white; }

/* ===== Confirmation Modal ===== */
.confirm-modal-backdrop {
  position:fixed; inset:0; z-index:10000;
  background:rgba(0,0,0,0.4); backdrop-filter:blur(4px); -webkit-backdrop-filter:blur(4px);
  display:flex; align-items:center; justify-content:center;
  animation:fadeIn 0.15s ease;
}
.confirm-modal {
  background:#fff; border-radius:14px; padding:1.5rem;
  max-width:340px; width:calc(100% - 2rem);
  box-shadow:0 8px 40px rgba(0,0,0,0.2);
  animation:modalIn 0.2s ease;
}
.confirm-modal-msg {
  margin:0 0 1.25rem; font-size:0.9rem; color:#1d1d1f;
  line-height:1.5; text-align:center;
}
.confirm-modal-actions {
  display:flex; gap:0.5rem;
}
.confirm-modal-btn {
  flex:1; padding:0.6rem 1rem; font-size:0.85rem; font-weight:500;
  border-radius:8px; cursor:pointer; border:1px solid #d1d5db;
  background:#f3f4f6; color:#374151; transition:all 0.15s;
}
.confirm-modal-btn:hover { background:#e5e7eb; }
.confirm-modal-btn.confirm { background:#3b82f6; color:#fff; border-color:#3b82f6; }
.confirm-modal-btn.confirm:hover { background:#2563eb; }
.confirm-modal-btn.confirm.danger { background:#dc2626; color:#fff; border-color:#dc2626; }
.confirm-modal-btn.confirm.danger:hover { background:#b91c1c; }
@keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
@keyframes modalIn { from { opacity:0; transform:scale(0.95); } to { opacity:1; transform:scale(1); } }

/* Dark mode modal */
.dark-mode .confirm-modal { background:#1e1e20; box-shadow:0 8px 40px rgba(0,0,0,0.5); }
.dark-mode .confirm-modal-msg { color:#f5f5f7; }
.dark-mode .confirm-modal-btn { background:#2a2a2c; border-color:#3a3a3c; color:#d2d2d7; }
.dark-mode .confirm-modal-btn:hover { background:#3a3a3c; }
.dark-mode .confirm-modal-btn.confirm { background:#0a84ff; border-color:#0a84ff; color:#fff; }
.dark-mode .confirm-modal-btn.confirm:hover { background:#0071e3; }
.dark-mode .confirm-modal-btn.confirm.danger { background:#ff453a; border-color:#ff453a; }
.dark-mode .confirm-modal-btn.confirm.danger:hover { background:#dc2626; }

/* ===== Editor Top Row ===== */
.editor-top-row {
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom:12px;
}
.editor-top-row .back-link { display:block; text-align:left; }
.delete-song-btn-sm {
  padding:4px 10px; font-size:0.7rem; font-weight:500;
  border-radius:5px; cursor:pointer; border:1px solid #fecaca;
  background:transparent; color:#dc2626; transition:all 0.15s;
  white-space:nowrap; flex-shrink:0;
}
.delete-song-btn-sm:hover { background:#fef2f2; }
.dark-mode .delete-song-btn-sm { border-color:#5c2020; color:#ff6961; }
.dark-mode .delete-song-btn-sm:hover { background:#3a1c1c; }

/* ===== Dropdown overflow fix ===== */
.song-detail-dropdown {
  max-height:calc(100vh - 80px); overflow-y:auto;
}
@media (max-width:600px) {
  .song-detail-dropdown {
    position:fixed; top:auto; bottom:0; left:0; right:0;
    border-radius:14px 14px 0 0; max-height:60vh;
    animation:slideUpSheet 0.25s ease;
  }
  @keyframes slideUpSheet { from { transform:translateY(100%); } to { transform:translateY(0); } }
}

/* ===== Sidebar save button fix ===== */
@media (max-width:900px) {
  .col-right-footer {
    position:sticky; bottom:0; z-index:50;
    background:#fff; border-top:1px solid #e5e7eb;
  }
  .dark-mode .col-right-footer { background:#141416; border-color:#2a2a2c; }
}

/* ===== Song Detail: Inline Edit Mode ===== */

/* Container flex layout when PDF panel is visible */
.exercise-view.edit-mode {
  flex-direction:row;
}
.exercise-view.edit-mode > .exercise-view-main {
  flex:1; min-width:0; overflow-y:auto;
}

/* PDF Panel (slides in from left) */
.edit-pdf-panel {
  display:none; flex-direction:column;
  width:45vw; max-width:600px; min-width:280px;
  background:#f9fafb; border-right:1px solid #e5e7eb;
  position:relative; flex-shrink:0; overflow:hidden;
  animation:seSlideIn 0.3s ease;
}
@keyframes seSlideIn {
  from { transform:translateX(-100%); opacity:0; }
  to { transform:translateX(0); opacity:1; }
}
.edit-pdf-inner {
  flex:1; display:flex; flex-direction:column;
  overflow:hidden; position:relative;
}
.dark-mode .edit-pdf-panel { background:#1a1a1c; border-color:#2a2a2c; }

/* PDF panel close button */
.edit-pdf-close-btn {
  position:absolute; top:8px; right:8px; z-index:10;
  width:28px; height:28px; border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  background:rgba(0,0,0,0.06); border:none; cursor:pointer;
  color:#6b7280; transition:all 0.15s;
}
.edit-pdf-close-btn:hover { background:rgba(0,0,0,0.12); color:#1a1a1a; }
.dark-mode .edit-pdf-close-btn { background:rgba(255,255,255,0.08); color:#aaa; }
.dark-mode .edit-pdf-close-btn:hover { background:rgba(255,255,255,0.15); color:#fff; }

/* PDF panel resize handle */
.edit-pdf-resize-handle {
  width:6px; cursor:col-resize; background:transparent;
  position:absolute; right:-3px; top:0; bottom:0; z-index:10;
  transition:background 0.15s;
}
.edit-pdf-resize-handle:hover { background:rgba(59,130,246,0.3); }

/* Upload zone within PDF panel */
.edit-pdf-panel .upload-zone {
  flex:1; display:flex; align-items:center; justify-content:center;
  margin:12px; border:2px dashed #d1d5db; border-radius:12px;
  background:transparent; transition:border-color 0.15s, background 0.15s;
}
.edit-pdf-panel .upload-zone.drag-over {
  border-color:#3b82f6; background:rgba(59,130,246,0.04);
}

/* Upload progress */
.edit-pdf-panel .upload-progress-area {
  display:flex; align-items:center; justify-content:center; gap:8px;
  padding:20px; color:#6b7280; font-size:0.85rem;
}

/* Upload error */
.edit-pdf-panel .upload-error-bar {
  display:flex; align-items:center; gap:8px;
  padding:8px 12px; background:#fef2f2; color:#dc2626;
  font-size:0.8rem; border-bottom:1px solid #fecaca;
}
.dark-mode .edit-pdf-panel .upload-error-bar { background:#3a1c1c; border-color:#5c2020; color:#ff6961; }

/* Pages scroll area in PDF panel */
.edit-pdf-panel .pages-scroll {
  flex:1; overflow:auto; position:relative;
}
.edit-pdf-panel .page-stack {
  display:flex; flex-direction:column; align-items:center; gap:8px; padding:8px;
}
.edit-pdf-panel .zoom-controls {
  position:absolute; bottom:12px; left:50%; transform:translateX(-50%);
  z-index:5;
}

/* Edit mode: section nav wrapper */
.se-section-nav-wrapper {
  padding:8px 0 4px;
}

/* Edit action buttons (slide out from edit button) */
.se-edit-actions {
  display:flex; align-items:center; gap:0.25rem;
  overflow:hidden; max-width:0; opacity:0;
  transition:max-width 0.3s cubic-bezier(0.4,0,0.2,1), opacity 0.2s ease, gap 0.3s ease;
}
.se-edit-actions.visible {
  max-width:220px; opacity:1;
}

/* Action button color overrides */
.se-action-btn.se-action-pdf { color:#3b82f6; }
.se-action-btn.se-action-pdf:hover { background:rgba(59,130,246,0.1); color:#3b82f6; }
.se-action-btn.se-action-pdf.active { color:#3b82f6; background:rgba(59,130,246,0.12); }
.dark-mode .se-action-btn.se-action-pdf { color:#60a5fa; }
.dark-mode .se-action-btn.se-action-pdf:hover { background:rgba(96,165,250,0.15); color:#60a5fa; }
.dark-mode .se-action-btn.se-action-pdf.active { color:#60a5fa; background:rgba(96,165,250,0.18); }

.se-action-btn.se-action-autofill { color:#8b5cf6; }
.se-action-btn.se-action-autofill:hover { background:rgba(139,92,246,0.1); color:#8b5cf6; }
.se-action-btn.se-action-autofill:disabled { opacity:0.4; cursor:default; }
.se-action-btn.se-action-autofill:disabled:hover { background:transparent; }
.dark-mode .se-action-btn.se-action-autofill { color:#a78bfa; }
.dark-mode .se-action-btn.se-action-autofill:hover { background:rgba(167,139,250,0.15); color:#a78bfa; }

.se-action-btn.se-action-delete { color:#dc2626; }
.se-action-btn.se-action-delete:hover { background:rgba(220,38,38,0.1); color:#dc2626; }
.dark-mode .se-action-btn.se-action-delete { color:#ff6961; }
.dark-mode .se-action-btn.se-action-delete:hover { background:rgba(255,105,97,0.12); color:#ff6961; }

.se-action-btn.se-action-save { color:#3b82f6; }
.se-action-btn.se-action-save:hover { background:rgba(59,130,246,0.1); color:#3b82f6; }
.dark-mode .se-action-btn.se-action-save { color:#60a5fa; }
.dark-mode .se-action-btn.se-action-save:hover { background:rgba(96,165,250,0.12); color:#60a5fa; }

.se-edit-actions .save-error {
  font-size:0.7rem; color:#dc2626; font-weight:500; white-space:nowrap;
}
.dark-mode .se-edit-actions .save-error { color:#ff6961; }

/* Edit mode visibility toggles */
.edit-mode .se-view-text { display:none !important; }
.edit-mode .se-edit-text { display:inline !important; }
.edit-mode .se-view-only { display:none !important; }
.edit-mode .se-edit-only { display:block !important; }
.edit-mode .se-practice-controls { display:none !important; }
.edit-mode .se-edit-controls { display:flex !important; }

/* Non-edit mode (defaults) */
.se-view-text { display:contents; }
.se-edit-text { display:none; }
.se-edit-controls { display:none; }
.se-edit-only { display:none; }

/* Card title edit input (inline) */
.card-title-edit {
  width:100%; padding:4px 8px; font-size:0.85rem; font-weight:600;
  background:transparent; border:1px solid transparent; border-radius:4px;
  color:#1a1a1a; transition:border-color 0.15s;
}
.card-title-edit:hover { border-color:#e5e7eb; }
.card-title-edit:focus { outline:none; border-color:#3b82f6; background:#fff; box-shadow:0 0 0 2px rgba(59,130,246,0.1); }
.card-title-edit::placeholder { color:#d1d5db; font-weight:500; }
.dark-mode .card-title-edit { color:#e5e7eb; }
.dark-mode .card-title-edit:hover { border-color:#444; }
.dark-mode .card-title-edit:focus { background:#222; border-color:#60a5fa; }
.dark-mode .card-title-edit::placeholder { color:#555; }

/* Card section select in edit controls */
.card-section-select {
  padding:4px 6px; font-size:0.75rem; border-radius:6px;
  border:1px solid #e5e7eb; background:#fff; color:#374151;
  cursor:pointer; appearance:auto;
}
.dark-mode .card-section-select { background:#222224; color:#e5e7eb; border-color:#333; }

/* Card delete button in edit controls */
.card-delete-btn {
  padding:4px 8px; font-size:0.72rem; font-weight:500;
  border-radius:5px; cursor:pointer; border:1px solid #fecaca;
  background:transparent; color:#dc2626; transition:all 0.15s;
  margin-left:auto; white-space:nowrap;
}
.card-delete-btn:hover { background:#fef2f2; }
.dark-mode .card-delete-btn { border-color:#5c2020; color:#ff6961; }
.dark-mode .card-delete-btn:hover { background:#3a1c1c; }

/* Zoom +/- buttons on cards */
.card-zoom-btn {
  width:26px; height:26px; display:flex; align-items:center; justify-content:center;
  padding:0; font-size:0.9rem; font-weight:700; line-height:1;
  border:1px solid #e5e7eb; border-radius:5px;
  background:#f9fafb; color:#6b7280; cursor:pointer;
  transition:all 0.15s; flex-shrink:0;
}
.card-zoom-btn:hover { background:#eff6ff; color:#3b82f6; border-color:#93c5fd; }
.card-zoom-btn:active { background:#dbeafe; }
.dark-mode .card-zoom-btn { background:#1e1e20; border-color:#2a2a2c; color:#d2d2d7; }
.dark-mode .card-zoom-btn:hover { background:#253040; color:#60a5fa; border-color:#3b82f6; }
.dark-mode .card-zoom-btn:active { background:#1e3050; }

/* Edit toggle button active state */
.edit-mode #edit-toggle-btn {
  color:#3b82f6; background:rgba(59,130,246,0.1);
}
.dark-mode .edit-mode #edit-toggle-btn {
  color:#60a5fa; background:rgba(96,165,250,0.15);
}

/* Confirm Modal */
.confirm-modal-backdrop {
  position:fixed; inset:0; z-index:9999;
  background:rgba(0,0,0,0.5); display:flex;
  align-items:center; justify-content:center;
}
.confirm-modal {
  background:#fff; border-radius:12px; padding:24px;
  max-width:340px; width:90%; box-shadow:0 20px 60px rgba(0,0,0,0.2);
}
.dark-mode .confirm-modal { background:#222224; }
.confirm-modal-msg {
  font-size:0.9rem; color:#374151; margin:0 0 16px; line-height:1.5;
}
.dark-mode .confirm-modal-msg { color:#e5e7eb; }
.confirm-modal-actions {
  display:flex; gap:8px; justify-content:flex-end;
}
.confirm-modal-btn {
  padding:8px 16px; font-size:0.8rem; font-weight:600;
  border-radius:8px; cursor:pointer; border:1px solid #e5e7eb;
  background:#fff; color:#374151; transition:all 0.15s;
}
.confirm-modal-btn:hover { background:#f3f4f6; }
.confirm-modal-btn.confirm { background:#3b82f6; color:#fff; border-color:#3b82f6; }
.confirm-modal-btn.confirm:hover { background:#2563eb; }
.confirm-modal-btn.danger { background:#dc2626; color:#fff; border-color:#dc2626; }
.confirm-modal-btn.danger:hover { background:#b91c1c; }
.dark-mode .confirm-modal-btn { background:#2a2a2c; color:#e5e7eb; border-color:#444; }
.dark-mode .confirm-modal-btn:hover { background:#333; }
.dark-mode .confirm-modal-btn.confirm { background:#3b82f6; color:#fff; border-color:#3b82f6; }
.dark-mode .confirm-modal-btn.danger { background:#dc2626; color:#fff; border-color:#dc2626; }

/* Mobile: PDF panel goes full-width overlay */
@media (max-width:768px) {
  .exercise-view.edit-mode {
    flex-direction:column;
  }
  .edit-pdf-panel {
    width:100% !important; max-width:none;
    height:50vh; border-right:none; border-bottom:1px solid #e5e7eb;
    animation:seSlideDown 0.3s ease;
  }
  @keyframes seSlideDown {
    from { transform:translateY(-100%); opacity:0; }
    to { transform:translateY(0); opacity:1; }
  }
  .edit-pdf-resize-handle { display:none; }
  .dark-mode .edit-pdf-panel { border-color:#2a2a2c; }
}
