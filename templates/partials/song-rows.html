{{define "song-rows-inner"}}
{{if eq (len .AllSongs) 0}}
  <div class="library-no-results">
    <p class="no-results-text">No songs match</p>
  </div>
{{else}}
  <div class="library-grid">
    {{range .AllSongs}}
    <div class="song-card library-song"
         onclick="location.href='/songs/{{.ID}}'"
         title="{{.Title}}{{if .Artist}} â€” {{.Artist}}{{end}}"
         data-title="{{lower .Title}}"
         data-artist="{{lower .Artist}}"
         data-mastered="{{.MasteredCount}}"
         data-total="{{.ExerciseCount}}"
         data-last-practiced="{{derefStr .LastPracticedAt}}"
         data-created="{{.CreatedAt}}"
         {{if notNil .SpotifyURL}}data-spotify-url="{{derefStr .SpotifyURL}}"{{end}}>
      <div class="card-thumbnail">
        {{if and .JobID (gt .PageCount 0)}}
          <img src="/api/pages/{{.JobID}}/1" alt="{{.Title}}" class="thumbnail-img" loading="lazy" />
        {{else}}
          <div class="thumbnail-placeholder">ðŸŽµ</div>
        {{end}}
      </div>
      <div class="card-info">
        <span class="card-title">{{.Title}}</span>
        {{if .Artist}}<span class="card-artist">{{.Artist}}</span>{{end}}
        <div class="progress-row">
          {{$sc := .StageCounts}}
          <div class="progress-stage-bar progress-stage-bar-card">
            {{range seq 5}}
              {{$count := index $sc (sub . 1)}}
              {{if gt $count 0}}
              <div class="progress-stage-segment" style="flex:{{$count}};background:{{stageColor .}}"></div>
              {{end}}
            {{end}}
          </div>
          <span class="progress-fraction progress-fraction-sm">{{.MasteredCount}}/{{.ExerciseCount}}</span>
        </div>
      </div>
    </div>
    {{end}}
  </div>
{{end}}
{{end}}
